# 2025-12-29 ê²Œì‹œë¬¼ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„

> ì›¹/ëª¨ë°”ì¼ì—ì„œ ì‚¬ì§„ì„ ì„ íƒí•˜ê³  ì—…ë¡œë“œí•˜ì—¬ ê²Œì‹œë¬¼ì— í‘œì‹œí•˜ëŠ” ê¸°ëŠ¥ ì¶”ê°€

---

## ğŸ“‹ ëª©ì°¨
1. [ë°±ì—”ë“œ êµ¬í˜„](#ë°±ì—”ë“œ-êµ¬í˜„)
2. [í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„](#í”„ë¡ íŠ¸ì—”ë“œ-êµ¬í˜„)
3. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
4. [ì£¼ìš” ê°œë… ì„¤ëª…](#ì£¼ìš”-ê°œë…-ì„¤ëª…)

---

## ğŸ”§ ë°±ì—”ë“œ êµ¬í˜„

### 1ï¸âƒ£ Post ëª¨ë¸ ìˆ˜ì • (`backend/models/Post.js`)

**ë³€ê²½ ì‚¬í•­**: `images` í•„ë“œ ì¶”ê°€

```javascript
const postSchema = new mongoose.Schema({
  title: {
    type: String,
    required: [true, "ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"],
    trim: true,
    maxlength: [100, "ì œëª©ì€ 100ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤"],
  },
  content: {
    type: String,
    required: [true, "ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"],
  },
  author: {
    type: mongoose.Schema.Types.ObjectId,
    ref: "User",
    required: [true, "ì‘ì„±ìê°€ í•„ìš”í•©ë‹ˆë‹¤"],
  },
  // ğŸ†• ì´ë¯¸ì§€ URL ë°°ì—´ ì¶”ê°€
  images: [
    {
      type: String, // ì´ë¯¸ì§€ URL ì €ì¥ (ì˜ˆ: "/uploads/photo-1234567890.jpg")
    },
  ],
  likes: [
    {
      type: mongoose.Schema.Types.ObjectId,
      ref: "User",
    },
  ],
  createdAt: {
    type: Date,
    default: Date.now,
  },
  updatedAt: {
    type: Date,
    default: Date.now,
  },
});
```

**ì„¤ëª…**:
- `images`: ë¬¸ìì—´ ë°°ì—´ë¡œ ì´ë¯¸ì§€ URLì„ ì €ì¥
- ì‹¤ì œ íŒŒì¼ì€ ì„œë²„ì˜ `uploads/` í´ë”ì— ì €ì¥ë˜ê³ , DBì—ëŠ” ê²½ë¡œë§Œ ì €ì¥
- ë°°ì—´ì´ë¯€ë¡œ ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ì €ì¥ ê°€ëŠ¥

---

### 2ï¸âƒ£ Multer ë¯¸ë“¤ì›¨ì–´ ìƒì„± (`backend/middleware/upload.js`)

**ëª©ì **: íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ (Node.jsëŠ” ê¸°ë³¸ì ìœ¼ë¡œ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ ë¶ˆê°€ â†’ Multer ì‚¬ìš©)

```javascript
// ============================================================
// ğŸ“· ì´ë¯¸ì§€ ì—…ë¡œë“œ ë¯¸ë“¤ì›¨ì–´ (Multer)
// ============================================================
const multer = require("multer");
const path = require("path");
const fs = require("fs");

// 1ï¸âƒ£ uploads ë””ë ‰í† ë¦¬ ìƒì„± (ì—†ìœ¼ë©´ ìë™ ìƒì„±)
const uploadDir = path.join(__dirname, "../uploads");
if (!fs.existsSync(uploadDir)) {
  fs.mkdirSync(uploadDir, { recursive: true });
}

// ============================================================
// 2ï¸âƒ£ ì €ì¥ ì„¤ì •
// ============================================================
const storage = multer.diskStorage({
  // íŒŒì¼ ì €ì¥ ìœ„ì¹˜
  destination: (req, file, cb) => {
    cb(null, uploadDir); // backend/uploads/ í´ë”ì— ì €ì¥
  },
  
  // íŒŒì¼ëª… ì„¤ì • (ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ íƒ€ì„ìŠ¤íƒ¬í”„ + ëœë¤ê°’ ì¶”ê°€)
  filename: (req, file, cb) => {
    const uniqueSuffix = Date.now() + "-" + Math.round(Math.random() * 1e9);
    const ext = path.extname(file.originalname); // í™•ì¥ì ì¶”ì¶œ (.jpg, .png ë“±)
    const basename = path.basename(file.originalname, ext); // íŒŒì¼ëª… ì¶”ì¶œ
    
    // ìµœì¢… íŒŒì¼ëª…: "ì›ë³¸íŒŒì¼ëª…-1735477890123-987654321.jpg"
    cb(null, `${basename}-${uniqueSuffix}${ext}`);
  },
});

// ============================================================
// 3ï¸âƒ£ íŒŒì¼ í•„í„° (ì´ë¯¸ì§€ë§Œ í—ˆìš©)
// ============================================================
const fileFilter = (req, file, cb) => {
  // í—ˆìš©ëœ MIME íƒ€ì… ëª©ë¡
  const allowedMimes = [
    "image/jpeg",
    "image/jpg",
    "image/png",
    "image/gif",
    "image/webp"
  ];
  
  if (allowedMimes.includes(file.mimetype)) {
    cb(null, true); // í—ˆìš© âœ…
  } else {
    cb(
      new Error("ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤ (jpg, png, gif, webp)"),
      false // ê±°ë¶€ âŒ
    );
  }
};

// ============================================================
// 4ï¸âƒ£ Multer ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
// ============================================================
const upload = multer({
  storage: storage,        // ì €ì¥ ì„¤ì •
  fileFilter: fileFilter,  // íŒŒì¼ íƒ€ì… í•„í„°
  limits: {
    fileSize: 5 * 1024 * 1024, // 5MB ì œí•œ (ë°”ì´íŠ¸ ë‹¨ìœ„)
  },
});

module.exports = upload;
```

**ì£¼ìš” ê°œë…**:
- **multer.diskStorage()**: íŒŒì¼ì„ ë””ìŠ¤í¬ì— ì €ì¥í•˜ëŠ” ë°©ì‹ ì„¤ì •
- **destination**: ì €ì¥ ê²½ë¡œ
- **filename**: íŒŒì¼ëª… ìƒì„± ê·œì¹™ (ì¤‘ë³µ ë°©ì§€ ì¤‘ìš”!)
- **fileFilter**: ì—…ë¡œë“œ ì „ íŒŒì¼ ê²€ì¦ (í™•ì¥ì, MIME íƒ€ì…)
- **limits**: íŒŒì¼ í¬ê¸° ì œí•œ

---

### 3ï¸âƒ£ ê²Œì‹œë¬¼ ì‘ì„± API ìˆ˜ì • (`backend/routes/posts.js`)

**ë³€ê²½ ì‚¬í•­**: ì´ë¯¸ì§€ ì—…ë¡œë“œ ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€

```javascript
const express = require("express");
const router = express.Router();
const Post = require("../models/Post");
const upload = require("../middleware/upload"); // ğŸ†• Multer ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€

// @route   POST /api/posts
// @desc    ê²Œì‹œë¬¼ ì‘ì„± (ì´ë¯¸ì§€ ì—…ë¡œë“œ í¬í•¨)
// @access  Public
router.post("/", upload.array("images", 5), async (req, res) => {
  //            â†‘ ì—¬ê¸°ê°€ í•µì‹¬!
  //            - upload.array("images", 5): "images"ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ìµœëŒ€ 5ê°œ íŒŒì¼ ë°›ìŒ
  //            - í”„ë¡ íŠ¸ì—ì„œ FormDataì— "images" ì´ë¦„ìœ¼ë¡œ ë³´ë‚´ì•¼ í•¨
  
  try {
    const { title, content } = req.body; // í…ìŠ¤íŠ¸ í•„ë“œëŠ” req.bodyì—ì„œ

    if (!title || !content) {
      return res.status(400).json({
        success: false,
        message: "ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”",
      });
    }

    // ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´ëŠ” req.filesì— ì €ì¥ë¨ (Multerê°€ ìë™ìœ¼ë¡œ)
    // req.files = [
    //   { filename: "photo-1234567890.jpg", ... },
    //   { filename: "photo-9876543210.jpg", ... }
    // ]
    
    // íŒŒì¼ëª…ì„ URL ê²½ë¡œë¡œ ë³€í™˜
    const images = req.files
      ? req.files.map((file) => `/uploads/${file.filename}`)
      : [];
    // ê²°ê³¼: ["/uploads/photo-1234567890.jpg", "/uploads/photo-9876543210.jpg"]

    const post = await Post.create({
      title,
      content,
      images, // ğŸ†• ì´ë¯¸ì§€ URL ë°°ì—´ ì €ì¥
      author: "69474f413ddedc3f0f26366e",
    });

    res.status(201).json({
      success: true,
      message: "ê²Œì‹œë¬¼ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤",
      data: { post },
    });
  } catch (error) {
    console.error("ê²Œì‹œë¬¼ ì‘ì„± ì—ëŸ¬:", error);
    res.status(500).json({
      success: false,
      message: error.message || "ê²Œì‹œë¬¼ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",
    });
  }
});
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- `upload.array("images", 5)`: **ë¯¸ë“¤ì›¨ì–´**ë¡œ ë™ì‘
  - ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ ì‹¤í–‰ **ì „**ì— íŒŒì¼ ì²˜ë¦¬
  - `req.files`ì— ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´ ì €ì¥
  - ìµœëŒ€ 5ê°œê¹Œì§€ í—ˆìš©
- `req.body`: ì¼ë°˜ í…ìŠ¤íŠ¸ í•„ë“œ (title, content)
- `req.files`: ì—…ë¡œë“œëœ íŒŒì¼ ë°°ì—´

---

### 4ï¸âƒ£ ì •ì  íŒŒì¼ ì„œë¹™ ì„¤ì • (`backend/index.js`)

**ë³€ê²½ ì‚¬í•­**: `/uploads` ê²½ë¡œë¡œ ì´ë¯¸ì§€ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •

```javascript
const express = require("express");
const path = require("path"); // ğŸ†• path ëª¨ë“ˆ ì¶”ê°€
const app = express();

// CORS ì„¤ì •
app.use(cors());
app.use(express.json());

// ğŸ†• ì •ì  íŒŒì¼ ì œê³µ (ì—…ë¡œë“œëœ ì´ë¯¸ì§€)
app.use("/uploads", express.static(path.join(__dirname, "uploads")));
//      â†‘ URL ê²½ë¡œ    â†‘ ì‹¤ì œ í´ë” ê²½ë¡œ
// ì˜ˆ: http://localhost:3001/uploads/photo-123.jpg
//     â†’ backend/uploads/photo-123.jpg íŒŒì¼ ì œê³µ

// MongoDB ì—°ê²°
connectDB();

// Routes
app.use("/api/auth", authRoutes);
app.use("/api/posts", postRoutes);
```

**ì„¤ëª…**:
- `express.static()`: ì •ì  íŒŒì¼(ì´ë¯¸ì§€, CSS, JS ë“±)ì„ ì œê³µí•˜ëŠ” ë¯¸ë“¤ì›¨ì–´
- `/uploads` ê²½ë¡œë¡œ ìš”ì²­ â†’ `backend/uploads/` í´ë”ì—ì„œ íŒŒì¼ ì°¾ì•„ì„œ ì‘ë‹µ
- ì˜ˆì‹œ:
  ```
  ìš”ì²­: GET http://localhost:3001/uploads/photo-123.jpg
  ì‘ë‹µ: backend/uploads/photo-123.jpg íŒŒì¼ ë‚´ìš©
  ```

---

## ğŸ’» í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„

### 1ï¸âƒ£ ê²Œì‹œë¬¼ ì‘ì„± í¼ ìˆ˜ì • (`frontend/src/components/PostCreate.jsx`)

#### State ì¶”ê°€

```jsx
import { useState } from "react";

function PostCreate() {
  const [formData, setFormData] = useState({
    title: "",
    content: "",
  });
  
  // ğŸ†• ì´ë¯¸ì§€ ê´€ë ¨ state
  const [images, setImages] = useState([]);           // ì‹¤ì œ íŒŒì¼ ê°ì²´ ë°°ì—´
  const [imagePreviews, setImagePreviews] = useState([]); // ë¯¸ë¦¬ë³´ê¸° URL ë°°ì—´
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
```

**ì„¤ëª…**:
- `images`: ì—…ë¡œë“œí•  ì‹¤ì œ íŒŒì¼ ê°ì²´ (`File` ê°ì²´ ë°°ì—´)
- `imagePreviews`: ë¸Œë¼ìš°ì €ì— í‘œì‹œí•  ë¯¸ë¦¬ë³´ê¸° URL (`blob:http://...`)

---

#### ì´ë¯¸ì§€ ì„ íƒ í•¸ë“¤ëŸ¬

```jsx
// ì´ë¯¸ì§€ ì„ íƒ í•¸ë“¤ëŸ¬
const handleImageChange = (e) => {
  const files = Array.from(e.target.files); // FileListë¥¼ ë°°ì—´ë¡œ ë³€í™˜
  // e.target.files = FileList { 0: File, 1: File, length: 2 }
  // Array.from() â†’ [File, File]
  
  // 1ï¸âƒ£ ìµœëŒ€ 5ê°œ ì œí•œ
  if (files.length + images.length > 5) {
    setError("ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 5ê°œê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    return;
  }

  // 2ï¸âƒ£ íŒŒì¼ í¬ê¸° ì²´í¬ (5MB)
  const oversizedFiles = files.filter((file) => file.size > 5 * 1024 * 1024);
  if (oversizedFiles.length > 0) {
    setError("ì´ë¯¸ì§€ëŠ” 5MB ì´í•˜ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    return;
  }

  setError("");
  
  // 3ï¸âƒ£ íŒŒì¼ ê°ì²´ ì €ì¥
  setImages([...images, ...files]);

  // 4ï¸âƒ£ ë¯¸ë¦¬ë³´ê¸° URL ìƒì„±
  const newPreviews = files.map((file) => URL.createObjectURL(file));
  // URL.createObjectURL(file) â†’ "blob:http://localhost:5173/abc-123-def"
  // ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ì— ì„ì‹œ URL ìƒì„± (ì‹¤ì œ ì—…ë¡œë“œ ì „)
  
  setImagePreviews([...imagePreviews, ...newPreviews]);
};
```

**ì£¼ìš” ê°œë…**:
- **FileList â†’ Array**: `Array.from(e.target.files)`ë¡œ ë°°ì—´ ë³€í™˜
- **URL.createObjectURL()**: 
  - ë¡œì»¬ íŒŒì¼ì„ ë¸Œë¼ìš°ì €ì—ì„œ ë¯¸ë¦¬ë³´ê¸° ê°€ëŠ¥í•œ URLë¡œ ë³€í™˜
  - ë©”ëª¨ë¦¬ì—ë§Œ ì¡´ì¬ (ì„œë²„ ì—…ë¡œë“œ X)
  - ì‚¬ìš© í›„ ë°˜ë“œì‹œ `URL.revokeObjectURL()`ë¡œ ë©”ëª¨ë¦¬ í•´ì œ í•„ìš”

---

#### ì´ë¯¸ì§€ ì‚­ì œ í•¸ë“¤ëŸ¬

```jsx
// ì´ë¯¸ì§€ ì‚­ì œ
const handleRemoveImage = (index) => {
  const newImages = images.filter((_, i) => i !== index);
  const newPreviews = imagePreviews.filter((_, i) => i !== index);
  
  // ğŸ”¥ ë©”ëª¨ë¦¬ í•´ì œ (ì¤‘ìš”!)
  URL.revokeObjectURL(imagePreviews[index]);
  // blob URLì„ ë©”ëª¨ë¦¬ì—ì„œ ì œê±° (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
  
  setImages(newImages);
  setImagePreviews(newPreviews);
};
```

**ì¤‘ìš”**: `URL.revokeObjectURL()`ì„ ë°˜ë“œì‹œ í˜¸ì¶œí•´ì•¼ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€!

---

#### FormDataë¡œ ì „ì†¡

```jsx
const handleSubmit = async (e) => {
  e.preventDefault();
  setError("");

  if (!formData.title.trim() || !formData.content.trim()) {
    setError("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  try {
    setLoading(true);
    
    // ğŸ†• FormData ìƒì„± (JSON ëŒ€ì‹  ì‚¬ìš©)
    const data = new FormData();
    
    // 1ï¸âƒ£ í…ìŠ¤íŠ¸ í•„ë“œ ì¶”ê°€
    data.append("title", formData.title);
    data.append("content", formData.content);
    
    // 2ï¸âƒ£ ì´ë¯¸ì§€ íŒŒì¼ ì¶”ê°€ (ê°™ì€ keyë¡œ ì—¬ëŸ¬ ê°œ)
    images.forEach((image) => {
      data.append("images", image); // "images"ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì¶”ê°€ (ë°±ì—”ë“œì™€ ì¼ì¹˜!)
    });
    
    // data ë‚´ìš©:
    // FormData {
    //   title: "ì‚¬ì§„ í…ŒìŠ¤íŠ¸",
    //   content: "ë‚´ìš©ì…ë‹ˆë‹¤",
    //   images: File { ... },  // ì²« ë²ˆì§¸ ì´ë¯¸ì§€
    //   images: File { ... },  // ë‘ ë²ˆì§¸ ì´ë¯¸ì§€
    // }

    const result = await createPost(data); // FormData ì „ì†¡

    if (result.success) {
      // ğŸ”¥ ë©”ëª¨ë¦¬ í•´ì œ (ëª¨ë“  blob URL)
      imagePreviews.forEach((url) => URL.revokeObjectURL(url));
      navigate("/posts");
    }
  } catch (err) {
    setError(err.response?.data?.message || "ê²Œì‹œë¬¼ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
  } finally {
    setLoading(false);
  }
};
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- **FormData ì‚¬ìš© ì´ìœ **:
  - JSONì€ íŒŒì¼ ì „ì†¡ ë¶ˆê°€ âŒ
  - FormDataëŠ” íŒŒì¼ + í…ìŠ¤íŠ¸ í˜¼í•© ì „ì†¡ ê°€ëŠ¥ âœ…
- **append("images", file)**: 
  - ê°™ì€ keyë¡œ ì—¬ëŸ¬ ê°œ ì¶”ê°€ ê°€ëŠ¥
  - ë°±ì—”ë“œì˜ `upload.array("images", 5)`ì™€ **ì´ë¦„ì´ ì¼ì¹˜**í•´ì•¼ í•¨!

---

#### UI ì½”ë“œ (ì´ë¯¸ì§€ ì„ íƒ ë²„íŠ¼ + ë¯¸ë¦¬ë³´ê¸°)

```jsx
{/* ì´ë¯¸ì§€ ì—…ë¡œë“œ */}
<div>
  <label className="block text-gray-700 font-semibold mb-2">
    ì´ë¯¸ì§€ ({images.length}/5)
  </label>
  
  {/* íŒŒì¼ input (ìˆ¨ê¹€) */}
  <input
    type="file"
    accept="image/*"  // ì´ë¯¸ì§€ë§Œ ì„ íƒ ê°€ëŠ¥
    multiple          // ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥
    onChange={handleImageChange}
    className="hidden"
    id="image-upload"
  />
  
  {/* ì»¤ìŠ¤í…€ ë²„íŠ¼ (labelì„ ë²„íŠ¼ì²˜ëŸ¼ ì‚¬ìš©) */}
  <label
    htmlFor="image-upload"
    className="flex items-center justify-center w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition"
  >
    <span className="text-gray-600">
      ğŸ“· ì´ë¯¸ì§€ ì„ íƒ (ìµœëŒ€ 5ê°œ, ê° 5MB ì´í•˜)
    </span>
  </label>

  {/* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° */}
  {imagePreviews.length > 0 && (
    <div className="grid grid-cols-2 sm:grid-cols-3 gap-3 mt-3">
      {imagePreviews.map((preview, index) => (
        <div key={index} className="relative group">
          {/* ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ */}
          <img
            src={preview}  // blob:http://... URL
            alt={`ë¯¸ë¦¬ë³´ê¸° ${index + 1}`}
            className="w-full h-32 object-cover rounded-lg border border-gray-200"
          />
          
          {/* ì‚­ì œ ë²„íŠ¼ (hover ì‹œ í‘œì‹œ) */}
          <button
            type="button"
            onClick={() => handleRemoveImage(index)}
            className="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition"
          >
            Ã—
          </button>
        </div>
      ))}
    </div>
  )}
</div>
```

**UI í¬ì¸íŠ¸**:
- `<input type="file" className="hidden">`: ê¸°ë³¸ íŒŒì¼ ì„ íƒ ë²„íŠ¼ ìˆ¨ê¹€
- `<label htmlFor="image-upload">`: label í´ë¦­ â†’ input ì‹¤í–‰
- `accept="image/*"`: ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì„ íƒ ê°€ëŠ¥
- `multiple`: ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥
- `group-hover:opacity-100`: ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì‚­ì œ ë²„íŠ¼ í‘œì‹œ

---

### 2ï¸âƒ£ API í•¨ìˆ˜ ìˆ˜ì • (`frontend/src/api.js`)

#### Axios ê¸°ë³¸ ì„¤ì • ìˆ˜ì •

```javascript
// âŒ ê¸°ì¡´ ì½”ë“œ (ë¬¸ì œ ë°œìƒ)
const api = axios.create({
  baseURL: `${API_URL}/api`,
  timeout: 30000,
  headers: {
    "Content-Type": "application/json", // â† ì´ê²Œ ë¬¸ì œ!
  },
});

// âœ… ìˆ˜ì •ëœ ì½”ë“œ
const api = axios.create({
  baseURL: `${API_URL}/api`,
  timeout: 30000,
  // Content-Type ì œê±°! (ìš”ì²­ë§ˆë‹¤ ìë™ ì„¤ì •)
});
```

**ì™œ ì œê±°í–ˆë‚˜ìš”?**
- FormData ì „ì†¡ ì‹œ `Content-Type`ì´ `multipart/form-data; boundary=...`ë¡œ ìë™ ì„¤ì •ë˜ì–´ì•¼ í•¨
- ê¸°ë³¸ ì„¤ì •ì— `application/json`ì´ ìˆìœ¼ë©´ ë®ì–´ì”Œì›Œì§
- ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ì˜¬ë°”ë¥¸ `Content-Type` ì„¤ì •

---

#### createPost í•¨ìˆ˜ ìˆ˜ì •

```javascript
// ê²Œì‹œë¬¼ ì‘ì„±
export const createPost = async (postData) => {
  const token = localStorage.getItem("token");
  
  // FormDataì¸ì§€ í™•ì¸
  const isFormData = postData instanceof FormData;
  
  const response = await api.post("/posts", postData, {
    headers: {
      Authorization: `Bearer ${token}`,
      // FormDataë©´ Content-Type ì œê±° (ë¸Œë¼ìš°ì €ê°€ ìë™ ì„¤ì •)
      // JSONì´ë©´ Content-Type ëª…ì‹œ
      ...(isFormData ? {} : { "Content-Type": "application/json" }),
    },
  });
  return response.data;
};
```

**ì„¤ëª…**:
- `postData instanceof FormData`: FormData ê°ì²´ì¸ì§€ í™•ì¸
- FormData ì „ì†¡ ì‹œ:
  - `Content-Type` í—¤ë” ì œê±°
  - ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ `multipart/form-data; boundary=----WebKitFormBoundary...` ì„¤ì •
- ì¼ë°˜ JSON ì „ì†¡ ì‹œ:
  - `Content-Type: application/json` ëª…ì‹œ

---

### 3ï¸âƒ£ ê²Œì‹œë¬¼ ìƒì„¸ í˜ì´ì§€ (`frontend/src/components/PostDetail.jsx`)

```jsx
{/* ì´ë¯¸ì§€ í‘œì‹œ */}
{post.images && post.images.length > 0 && (
  <div className="mb-6">
    {/* ì´ë¯¸ì§€ê°€ 1ê°œë©´ í° ì´ë¯¸ì§€ë¡œ í‘œì‹œ */}
    {post.images.length === 1 ? (
      <img
        src={`${import.meta.env.VITE_API_URL || "http://localhost:3001"}${post.images[0]}`}
        //    â†‘ í™˜ê²½ë³€ìˆ˜                      â†‘ ê¸°ë³¸ê°’                    â†‘ "/uploads/photo-123.jpg"
        // ê²°ê³¼: "http://localhost:3001/uploads/photo-123.jpg"
        alt="ê²Œì‹œë¬¼ ì´ë¯¸ì§€"
        className="w-full rounded-lg"
      />
    ) : (
      /* ì´ë¯¸ì§€ê°€ 2ê°œ ì´ìƒì´ë©´ ê·¸ë¦¬ë“œë¡œ í‘œì‹œ */
      <div className="grid grid-cols-2 gap-3">
        {post.images.map((image, index) => (
          <img
            key={index}
            src={`${import.meta.env.VITE_API_URL || "http://localhost:3001"}${image}`}
            alt={`ê²Œì‹œë¬¼ ì´ë¯¸ì§€ ${index + 1}`}
            className="w-full h-48 object-cover rounded-lg"
          />
        ))}
      </div>
    )}
  </div>
)}
```

**URL ì¡°í•© ë°©ì‹**:
```
í™˜ê²½ë³€ìˆ˜ (VITE_API_URL) + ì´ë¯¸ì§€ ê²½ë¡œ
"http://localhost:3001" + "/uploads/photo-123.jpg"
= "http://localhost:3001/uploads/photo-123.jpg"
```

---

### 4ï¸âƒ£ ê²Œì‹œë¬¼ ëª©ë¡ (`frontend/src/components/PostList.jsx`)

```jsx
<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
  {posts.map((post) => (
    <div key={post._id} className="border rounded-lg p-5">
      <div onClick={() => navigate(`/posts/${post._id}`)}>
        
        {/* ğŸ†• ì´ë¯¸ì§€ ì¸ë„¤ì¼ (ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë§Œ) */}
        {post.images && post.images.length > 0 && (
          <img
            src={`${import.meta.env.VITE_API_URL || "http://localhost:3001"}${post.images[0]}`}
            alt={post.title}
            className="w-full h-40 object-cover rounded-lg mb-3"
          />
        )}

        <h2 className="text-lg font-bold">{post.title}</h2>
        <p className="text-gray-600">{post.content.substring(0, 150)}...</p>
      </div>
    </div>
  ))}
</div>
```

**í¬ì¸íŠ¸**:
- `post.images[0]`: ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë§Œ ì¸ë„¤ì¼ë¡œ í‘œì‹œ
- `object-cover`: ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì˜ì—­ ì±„ìš°ê¸°
- `h-40`: ê³ ì • ë†’ì´ë¡œ í†µì¼ê° ìœ ì§€

---

## ğŸ“Š ë°ì´í„° íë¦„

### ì „ì²´ íë¦„ë„

```
1ï¸âƒ£ ì‚¬ìš©ìê°€ ì´ë¯¸ì§€ ì„ íƒ
   â†“
2ï¸âƒ£ handleImageChange() ì‹¤í–‰
   - File ê°ì²´ë¥¼ images ë°°ì—´ì— ì €ì¥
   - URL.createObjectURL()ë¡œ ë¯¸ë¦¬ë³´ê¸° URL ìƒì„±
   â†“
3ï¸âƒ£ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ (imagePreviews ë°°ì—´ ì‚¬ìš©)
   â†“
4ï¸âƒ£ "ì‘ì„±í•˜ê¸°" ë²„íŠ¼ í´ë¦­
   â†“
5ï¸âƒ£ handleSubmit() ì‹¤í–‰
   - FormData ìƒì„±
   - title, content, images ì¶”ê°€
   â†“
6ï¸âƒ£ createPost(formData) í˜¸ì¶œ
   - axios POST /api/posts
   - Content-Type: multipart/form-data
   â†“
7ï¸âƒ£ ë°±ì—”ë“œ Multer ë¯¸ë“¤ì›¨ì–´ ì‹¤í–‰
   - íŒŒì¼ ì €ì¥: backend/uploads/photo-123.jpg
   - req.filesì— íŒŒì¼ ì •ë³´ ì €ì¥
   â†“
8ï¸âƒ£ POST /api/posts ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ ì‹¤í–‰
   - req.files â†’ images ë°°ì—´ ìƒì„±
   - Post.create({ title, content, images })
   - MongoDBì— ì €ì¥
   â†“
9ï¸âƒ£ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì‘ë‹µ
   {
     success: true,
     data: {
       post: {
         _id: "...",
         title: "...",
         content: "...",
         images: ["/uploads/photo-123.jpg"],
         ...
       }
     }
   }
   â†“
ğŸ”Ÿ ëª©ë¡/ìƒì„¸ í˜ì´ì§€ì—ì„œ ì´ë¯¸ì§€ í‘œì‹œ
   - <img src="http://localhost:3001/uploads/photo-123.jpg">
   - express.static()ì´ íŒŒì¼ ì œê³µ
```

---

## ğŸ’¡ ì£¼ìš” ê°œë… ì„¤ëª…

### 1. FormDataë€?

**ì •ì˜**: HTML í¼ ë°ì´í„°ë¥¼ í‘œí˜„í•˜ëŠ” ê°ì²´ (íŒŒì¼ + í…ìŠ¤íŠ¸ í˜¼í•© ê°€ëŠ¥)

```javascript
// ì¼ë°˜ JSON (íŒŒì¼ ì „ì†¡ ë¶ˆê°€)
const data = {
  title: "ì œëª©",
  content: "ë‚´ìš©",
  image: ??? // File ê°ì²´ ì§ë ¬í™” ë¶ˆê°€
};

// FormData (íŒŒì¼ ì „ì†¡ ê°€ëŠ¥)
const formData = new FormData();
formData.append("title", "ì œëª©");
formData.append("content", "ë‚´ìš©");
formData.append("image", fileObject); // File ê°ì²´ ê°€ëŠ¥!
```

**ì „ì†¡ í˜•ì‹** (`multipart/form-data`):
```
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="title"

ì‚¬ì§„ í…ŒìŠ¤íŠ¸
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="content"

ë‚´ìš©ì…ë‹ˆë‹¤
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="images"; filename="photo.jpg"
Content-Type: image/jpeg

(ë°”ì´ë„ˆë¦¬ ë°ì´í„°...)
------WebKitFormBoundary7MA4YWxkTrZu0gW--
```

---

### 2. Multer ë™ì‘ ì›ë¦¬

**Multer**: Node.jsìš© `multipart/form-data` íŒŒì‹± ë¯¸ë“¤ì›¨ì–´

```javascript
// ë¯¸ë“¤ì›¨ì–´ ì²´ì¸
app.post("/api/posts", upload.array("images", 5), async (req, res) => {
  // â†‘ 1. upload.array() ë¨¼ì € ì‹¤í–‰
  //    - FormData íŒŒì‹±
  //    - íŒŒì¼ ì €ì¥
  //    - req.filesì— ì •ë³´ ì €ì¥
  
  // â†“ 2. ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ ì‹¤í–‰
  const images = req.files.map(...);
  await Post.create({ images });
});
```

**req.files êµ¬ì¡°**:
```javascript
[
  {
    fieldname: 'images',
    originalname: 'photo.jpg',
    encoding: '7bit',
    mimetype: 'image/jpeg',
    destination: '/path/to/uploads',
    filename: 'photo-1735477890123-987654321.jpg',
    path: '/path/to/uploads/photo-1735477890123-987654321.jpg',
    size: 245678
  },
  { ... } // ë‘ ë²ˆì§¸ íŒŒì¼
]
```

---

### 3. URL.createObjectURL() vs ì„œë²„ URL

| êµ¬ë¶„ | URL.createObjectURL() | ì„œë²„ URL |
|------|----------------------|----------|
| **ì‹œì ** | ì—…ë¡œë“œ ì „ (ë¯¸ë¦¬ë³´ê¸°) | ì—…ë¡œë“œ í›„ (ì‹¤ì œ í‘œì‹œ) |
| **í˜•íƒœ** | `blob:http://localhost:5173/abc-123` | `http://localhost:3001/uploads/photo.jpg` |
| **ìœ„ì¹˜** | ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ | ì„œë²„ ë””ìŠ¤í¬ |
| **ìˆ˜ëª…** | í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì‚¬ë¼ì§ | ì˜êµ¬ ë³´ì¡´ |
| **ë©”ëª¨ë¦¬** | ì‚¬ìš© í›„ `revokeObjectURL()` í•„ìš” | ê´€ë¦¬ ë¶ˆí•„ìš” |

**ì˜ˆì‹œ**:
```javascript
// ë¯¸ë¦¬ë³´ê¸° (ì—…ë¡œë“œ ì „)
const preview = URL.createObjectURL(file);
// "blob:http://localhost:5173/abc-123-def"

// ì„œë²„ ì´ë¯¸ì§€ (ì—…ë¡œë“œ í›„)
const serverUrl = "http://localhost:3001/uploads/photo-123.jpg";
```

---

### 4. express.static() ì‘ë™ ì›ë¦¬

```javascript
app.use("/uploads", express.static(path.join(__dirname, "uploads")));
```

**ë§¤ì¹­ ê³¼ì •**:
```
ìš”ì²­: GET http://localhost:3001/uploads/photo-123.jpg
  â†“
1. "/uploads" ê²½ë¡œ ë§¤ì¹­ âœ…
  â†“
2. "photo-123.jpg" ì¶”ì¶œ
  â†“
3. "backend/uploads/photo-123.jpg" íŒŒì¼ ê²€ìƒ‰
  â†“
4. íŒŒì¼ ì¡´ì¬? â†’ íŒŒì¼ ë‚´ìš© ì‘ë‹µ
   íŒŒì¼ ì—†ìŒ? â†’ 404 Not Found
```

---

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ì´ë¯¸ì§€ê°€ ì „ì†¡ë˜ì§€ ì•ŠìŒ (`images: Array(0)`)

**ì›ì¸**: axios ê¸°ë³¸ ì„¤ì •ì— `Content-Type: application/json` ê³ ì •

**í•´ê²°**:
```javascript
// âŒ ë¬¸ì œ ì½”ë“œ
const api = axios.create({
  headers: { "Content-Type": "application/json" } // ê³ ì •!
});

// âœ… í•´ê²° ì½”ë“œ
const api = axios.create({
  // Content-Type ì œê±° (ìš”ì²­ë§ˆë‹¤ ìë™ ì„¤ì •)
});
```

---

### ë¬¸ì œ 2: ì´ë¯¸ì§€ URLì´ ê¹¨ì§

**ì›ì¸**: í™˜ê²½ë³€ìˆ˜ì™€ ì´ë¯¸ì§€ ê²½ë¡œ ì¡°í•© ì˜¤ë¥˜

```javascript
// âŒ ì˜ëª»ëœ ì¡°í•©
VITE_API_URL=http://localhost:3001/api  // /api í¬í•¨
src={`${API_URL}${post.images[0]}`}
// ê²°ê³¼: http://localhost:3001/api/uploads/photo.jpg (404!)

// âœ… ì˜¬ë°”ë¥¸ ì¡°í•©
VITE_API_URL=http://localhost:3001      // /api ì œì™¸
src={`${API_URL}${post.images[0]}`}
// ê²°ê³¼: http://localhost:3001/uploads/photo.jpg (200 OK)
```

---

### ë¬¸ì œ 3: ë©”ëª¨ë¦¬ ëˆ„ìˆ˜

**ì›ì¸**: `URL.createObjectURL()` ì‚¬ìš© í›„ í•´ì œ ì•ˆ í•¨

```javascript
// âŒ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
const preview = URL.createObjectURL(file);
// ì‚¬ìš© í›„ í•´ì œ ì•ˆ í•¨ â†’ ë©”ëª¨ë¦¬ ê³„ì† ì ìœ 

// âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš©
const preview = URL.createObjectURL(file);
// ... ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ ...
URL.revokeObjectURL(preview); // ì‚¬ìš© í›„ í•´ì œ!
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°±ì—”ë“œ
- [x] Post ëª¨ë¸ì— `images` í•„ë“œ ì¶”ê°€
- [x] multer íŒ¨í‚¤ì§€ ì„¤ì¹˜ (`npm install multer`)
- [x] `backend/middleware/upload.js` ìƒì„±
- [x] `backend/uploads/` í´ë” ìë™ ìƒì„±
- [x] POST /api/postsì— `upload.array("images", 5)` ì¶”ê°€
- [x] `req.files`ë¡œ ì´ë¯¸ì§€ URL ë°°ì—´ ìƒì„±
- [x] `app.use("/uploads", express.static(...))` ì¶”ê°€

### í”„ë¡ íŠ¸ì—”ë“œ
- [x] PostCreate: `images`, `imagePreviews` state ì¶”ê°€
- [x] PostCreate: `handleImageChange()` êµ¬í˜„
- [x] PostCreate: `handleRemoveImage()` êµ¬í˜„
- [x] PostCreate: FormData ìƒì„± ë° ì „ì†¡
- [x] api.js: axios ê¸°ë³¸ `Content-Type` ì œê±°
- [x] api.js: `createPost()` FormData ì²˜ë¦¬
- [x] PostDetail: ì´ë¯¸ì§€ ê·¸ë¦¬ë“œ í‘œì‹œ
- [x] PostList: ì¸ë„¤ì¼ ì´ë¯¸ì§€ í‘œì‹œ

---

## ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸ ìš”ì•½

1. **íŒŒì¼ ì—…ë¡œë“œëŠ” FormData í•„ìˆ˜**
   - JSONì€ íŒŒì¼ ì „ì†¡ ë¶ˆê°€
   - `new FormData()` + `append("key", file)`

2. **Multer ë¯¸ë“¤ì›¨ì–´ ì„¤ì •**
   - `upload.array("images", 5)`: í•„ë“œëª…ê³¼ ê°œìˆ˜ ì§€ì •
   - `req.files`ì— ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´

3. **Content-Type ìë™ ì„¤ì •**
   - FormData ì „ì†¡ ì‹œ í—¤ë” ì œê±°
   - ë¸Œë¼ìš°ì €ê°€ `multipart/form-data; boundary=...` ìë™ ì„¤ì •

4. **URL.createObjectURL() ë©”ëª¨ë¦¬ ê´€ë¦¬**
   - ë¯¸ë¦¬ë³´ê¸°ìš© blob URL ìƒì„±
   - ì‚¬ìš© í›„ ë°˜ë“œì‹œ `revokeObjectURL()` í˜¸ì¶œ

5. **ì •ì  íŒŒì¼ ì œê³µ**
   - `express.static()`ìœ¼ë¡œ `/uploads` ê²½ë¡œ ì„¤ì •
   - ì—…ë¡œë“œëœ íŒŒì¼ HTTPë¡œ ì ‘ê·¼ ê°€ëŠ¥

6. **í™˜ê²½ë³€ìˆ˜ í™œìš©**
   - `VITE_API_URL`ë¡œ ì„œë²„ ì£¼ì†Œ ê´€ë¦¬
   - ë¡œì»¬/í”„ë¡œë•ì…˜ ìë™ ì „í™˜

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Multer ê³µì‹ ë¬¸ì„œ](https://github.com/expressjs/multer)
- [FormData MDN](https://developer.mozilla.org/ko/docs/Web/API/FormData)
- [URL.createObjectURL() MDN](https://developer.mozilla.org/ko/docs/Web/API/URL/createObjectURL)
- [Express Static Files](https://expressjs.com/en/starter/static-files.html)
