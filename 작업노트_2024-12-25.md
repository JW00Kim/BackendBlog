# ë¸”ë¡œê·¸ ê°œë°œ ì‘ì—… ë…¸íŠ¸ - 2024.12.25

## ğŸ“‹ ëª©ì°¨
1. [DB ì—°ê²° ë¬¸ì œ í•´ê²°](#1-db-ì—°ê²°-ë¬¸ì œ-í•´ê²°)
2. [ëŒ“ê¸€ ê¸°ëŠ¥ ì¶”ê°€](#2-ëŒ“ê¸€-ê¸°ëŠ¥-ì¶”ê°€)
3. [ì¢‹ì•„ìš” ê¸°ëŠ¥ ì¶”ê°€](#3-ì¢‹ì•„ìš”-ê¸°ëŠ¥-ì¶”ê°€)

---

## 1. DB ì—°ê²° ë¬¸ì œ í•´ê²°

### ë¬¸ì œ ìƒí™©
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `ERR_CONNECTION_REFUSED` ì—ëŸ¬ ë°œìƒ
- ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•„ API í˜¸ì¶œ ì‹¤íŒ¨

### í•´ê²° ë°©ë²•

#### 1.1 ë°±ì—”ë“œ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
**íŒŒì¼:** `backend/.env`
```env
# MongoDB Atlas ì—°ê²° URI
# <db_password> ë¶€ë¶„ì„ ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½
MONGODB_URI=mongodb+srv://yjk9363_db_user:<db_password>@blog.f4taven.mongodb.net/?appName=Blog

# JWT ì‹œí¬ë¦¿ í‚¤ (ë³´ì•ˆì„ ìœ„í•´ ë³µì¡í•œ ë¬¸ìì—´ ì‚¬ìš©)
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-2025

# ì„œë²„ í¬íŠ¸ (í”„ë¡ íŠ¸ì—”ë“œì™€ ì¼ì¹˜í•´ì•¼ í•¨)
PORT=3001
```

**ì„¤ëª…:**
- `MONGODB_URI`: MongoDB Atlas í´ëŸ¬ìŠ¤í„° ì—°ê²° ë¬¸ìì—´
- `JWT_SECRET`: í† í° ì•”í˜¸í™”ì— ì‚¬ìš©ë˜ëŠ” ë¹„ë°€ í‚¤
- `PORT`: ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ë  í¬íŠ¸ ë²ˆí˜¸

#### 1.2 í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
**íŒŒì¼:** `frontend/.env`
```env
# ë°±ì—”ë“œ API URL (ê°œë°œ í™˜ê²½)
VITE_API_URL=http://localhost:3001/api
```

**ì„¤ëª…:**
- Vite í™˜ê²½ë³€ìˆ˜ëŠ” `VITE_` ì ‘ë‘ì‚¬ í•„ìš”
- ë°±ì—”ë“œ í¬íŠ¸ì™€ ì¼ì¹˜í•´ì•¼ í•¨

#### 1.3 ë°±ì—”ë“œ ì„œë²„ ì‹œì‘ ë¡œê·¸ ì¶”ê°€
**íŒŒì¼:** `backend/index.js`
```javascript
// ë¡œì»¬ ê°œë°œ ì„œë²„ ì‹¤í–‰ (Vercelì—ì„œëŠ” ì‹¤í–‰ ì•ˆë¨)
if (process.env.NODE_ENV !== "production" && require.main === module) {
  app.listen(PORT, () => {
    console.log(`ğŸš€ ì„œë²„ê°€ http://localhost:${PORT} ì—ì„œ ì‹¤í–‰ì¤‘ì…ë‹ˆë‹¤`);
  });
}
```

**ì„¤ëª…:**
- `require.main === module`: íŒŒì¼ì´ ì§ì ‘ ì‹¤í–‰ë  ë•Œë§Œ ì„œë²„ ì‹œì‘
- Vercelì—ì„œëŠ” serverless í•¨ìˆ˜ë¡œ ì‘ë™í•˜ë¯€ë¡œ listen ë¶ˆí•„ìš”
- ê°œë°œ í™˜ê²½ì—ì„œë§Œ í¬íŠ¸ ë¡œê·¸ ì¶œë ¥

#### 1.4 MongoDB ì—°ê²° ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
**íŒŒì¼:** `backend/index.js`
```javascript
const connectDB = async () => {
  if (isConnected) {
    return;
  }

  try {
    // í™˜ê²½ë³€ìˆ˜ ì²´í¬
    if (!process.env.MONGODB_URI) {
      console.error(
        "âŒ MONGODB_URIê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. backend/.env ë˜ëŠ” Vercel í™˜ê²½ ë³€ìˆ˜ì— ê°’ì„ ë„£ì–´ì£¼ì„¸ìš”."
      );
      return;
    }

    // MongoDB ì—°ê²°
    if (process.env.MONGODB_URI) {
      await mongoose.connect(process.env.MONGODB_URI, {
        serverSelectionTimeoutMS: 5000,
        socketTimeoutMS: 10000,
      });
      isConnected = true;
      console.log("âœ… MongoDB ì—°ê²° ì„±ê³µ");
    }
  } catch (error) {
    console.error("âŒ MongoDB ì—°ê²° ì‹¤íŒ¨:", error.message);
  }
};
```

**ì„¤ëª…:**
- í™˜ê²½ë³€ìˆ˜ ëˆ„ë½ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
- íƒ€ì„ì•„ì›ƒ ì„¤ì •ìœ¼ë¡œ ë¬´í•œ ëŒ€ê¸° ë°©ì§€
- ì—°ê²° ìƒíƒœ ìºì‹±ìœ¼ë¡œ ì¤‘ë³µ ì—°ê²° ë°©ì§€

---

## 2. ëŒ“ê¸€ ê¸°ëŠ¥ ì¶”ê°€

### 2.1 Comment ëª¨ë¸ ìƒì„±
**íŒŒì¼:** `backend/models/Comment.js`
```javascript
const mongoose = require("mongoose");

// ëŒ“ê¸€ ìŠ¤í‚¤ë§ˆ ì •ì˜
const commentSchema = new mongoose.Schema({
  content: {
    type: String,
    required: [true, "ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"],
    trim: true,
    maxlength: [500, "ëŒ“ê¸€ì€ 500ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤"],
  },
  author: {
    type: mongoose.Schema.Types.ObjectId,
    ref: "User", // User ëª¨ë¸ ì°¸ì¡° (ëˆ„ê°€ ì¼ëŠ”ì§€)
    required: [true, "ì‘ì„±ìê°€ í•„ìš”í•©ë‹ˆë‹¤"],
  },
  post: {
    type: mongoose.Schema.Types.ObjectId,
    ref: "Post", // Post ëª¨ë¸ ì°¸ì¡° (ì–´ëŠ ê²Œì‹œë¬¼ì— ë‹¬ë¦° ëŒ“ê¸€ì¸ì§€)
    required: [true, "ê²Œì‹œë¬¼ì´ í•„ìš”í•©ë‹ˆë‹¤"],
  },
  createdAt: {
    type: Date,
    default: Date.now,
  },
});

// ìµœì‹  ëŒ“ê¸€ì´ ìœ„ë¡œ ì˜¤ë„ë¡ ê¸°ë³¸ ì •ë ¬ ì„¤ì •
commentSchema.index({ post: 1, createdAt: -1 });

module.exports = mongoose.model("Comment", commentSchema);
```

**ì„¤ëª…:**
- `content`: ëŒ“ê¸€ ë‚´ìš© (ìµœëŒ€ 500ì)
- `author`: ì‘ì„±ì ID (User ì»¬ë ‰ì…˜ ì°¸ì¡°)
- `post`: ê²Œì‹œë¬¼ ID (Post ì»¬ë ‰ì…˜ ì°¸ì¡°)
- `index`: ê²Œì‹œë¬¼ë³„ ìµœì‹ ìˆœ ì¡°íšŒ ì„±ëŠ¥ ìµœì í™”

### 2.2 ëŒ“ê¸€ API ë¼ìš°íŠ¸
**íŒŒì¼:** `backend/routes/comments.js`
```javascript
const express = require("express");
const router = express.Router();
const jwt = require("jsonwebtoken");
const Comment = require("../models/Comment");
const User = require("../models/User");
const Post = require("../models/Post");

// ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ (í† í° ê²€ì¦)
const authenticate = async (req, res, next) => {
  const authHeader = req.headers.authorization;

  if (!authHeader || !authHeader.startsWith("Bearer ")) {
    return res.status(401).json({
      success: false,
      message: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤",
    });
  }

  const token = authHeader.split(" ")[1];

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    const user = await User.findById(decoded.id);

    if (!user) {
      return res.status(401).json({
        success: false,
        message: "ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
      });
    }

    req.user = user;
    next();
  } catch (error) {
    console.error("ì¸ì¦ ì—ëŸ¬:", error);
    return res.status(401).json({
      success: false,
      message: "ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤",
    });
  }
};

// GET /api/posts/:postId/comments - ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
router.get("/posts/:postId/comments", async (req, res) => {
  try {
    const { postId } = req.params;

    // ê²Œì‹œë¬¼ ì¡´ì¬ í™•ì¸
    const post = await Post.findById(postId);
    if (!post) {
      return res.status(404).json({
        success: false,
        message: "ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
      });
    }

    // í•´ë‹¹ ê²Œì‹œë¬¼ì˜ ëŒ“ê¸€ ì¡°íšŒ (ìµœì‹ ìˆœ)
    const comments = await Comment.find({ post: postId })
      .populate("author", "name email") // ì‘ì„±ì ì •ë³´ í¬í•¨
      .sort({ createdAt: -1 }); // ìµœì‹ ìˆœ ì •ë ¬

    res.json({
      success: true,
      data: {
        comments,
        count: comments.length,
      },
    });
  } catch (error) {
    console.error("ëŒ“ê¸€ ì¡°íšŒ ì—ëŸ¬:", error);
    res.status(500).json({
      success: false,
      message: "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
      error: error.message,
    });
  }
});

// POST /api/posts/:postId/comments - ëŒ“ê¸€ ì‘ì„±
router.post("/posts/:postId/comments", authenticate, async (req, res) => {
  try {
    const { postId } = req.params;
    const { content } = req.body;

    // ë‚´ìš© ê²€ì¦
    if (!content || !content.trim()) {
      return res.status(400).json({
        success: false,
        message: "ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”",
      });
    }

    // ê²Œì‹œë¬¼ ì¡´ì¬ í™•ì¸
    const post = await Post.findById(postId);
    if (!post) {
      return res.status(404).json({
        success: false,
        message: "ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
      });
    }

    // ëŒ“ê¸€ ìƒì„±
    const comment = await Comment.create({
      content: content.trim(),
      author: req.user._id,
      post: postId,
    });

    // ì‘ì„±ì ì •ë³´ í¬í•¨í•´ì„œ ë°˜í™˜
    const populatedComment = await Comment.findById(comment._id).populate(
      "author",
      "name email"
    );

    res.status(201).json({
      success: true,
      message: "ëŒ“ê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤",
      data: {
        comment: populatedComment,
      },
    });
  } catch (error) {
    console.error("ëŒ“ê¸€ ì‘ì„± ì—ëŸ¬:", error);
    res.status(500).json({
      success: false,
      message: "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
      error: error.message,
    });
  }
});

// DELETE /api/comments/:id - ëŒ“ê¸€ ì‚­ì œ
router.delete("/comments/:id", authenticate, async (req, res) => {
  try {
    const { id } = req.params;

    const comment = await Comment.findById(id);

    if (!comment) {
      return res.status(404).json({
        success: false,
        message: "ëŒ“ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
      });
    }

    // ì‘ì„±ì ë³¸ì¸ í™•ì¸
    if (comment.author.toString() !== req.user._id.toString()) {
      return res.status(403).json({
        success: false,
        message: "ë³¸ì¸ì˜ ëŒ“ê¸€ë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤",
      });
    }

    await Comment.findByIdAndDelete(id);

    res.json({
      success: true,
      message: "ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤",
    });
  } catch (error) {
    console.error("ëŒ“ê¸€ ì‚­ì œ ì—ëŸ¬:", error);
    res.status(500).json({
      success: false,
      message: "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
      error: error.message,
    });
  }
});

module.exports = router;
```

**ì„¤ëª…:**
- `authenticate`: JWT í† í° ê²€ì¦ ë¯¸ë“¤ì›¨ì–´
- `populate("author")`: ì‘ì„±ì ì •ë³´ë¥¼ í•¨ê»˜ ì¡°íšŒ
- `sort({ createdAt: -1 })`: ìµœì‹  ëŒ“ê¸€ì´ ë¨¼ì € ë‚˜ì˜¤ë„ë¡ ì •ë ¬
- ë³¸ì¸ ëŒ“ê¸€ë§Œ ì‚­ì œ ê°€ëŠ¥í•˜ë„ë¡ ê¶Œí•œ ì²´í¬

### 2.3 ì„œë²„ì— ëŒ“ê¸€ ë¼ìš°íŠ¸ ë“±ë¡
**íŒŒì¼:** `backend/index.js`
```javascript
// Routes
const authRoutes = require("./routes/auth");
const postRoutes = require("./routes/posts");
const commentRoutes = require("./routes/comments"); // ì¶”ê°€

app.use("/api/auth", authRoutes);
app.use("/api/posts", postRoutes);
app.use("/api", commentRoutes); // ì¶”ê°€
```

**ì„¤ëª…:**
- `/api` ê²½ë¡œì— ëŒ“ê¸€ ë¼ìš°íŠ¸ ë“±ë¡
- `/api/posts/:postId/comments` í˜•íƒœë¡œ ì‚¬ìš©

### 2.4 í”„ë¡ íŠ¸ì—”ë“œ API í•¨ìˆ˜
**íŒŒì¼:** `frontend/src/api.js`
```javascript
// ===== Comments API =====

// íŠ¹ì • ê²Œì‹œë¬¼ì˜ ëŒ“ê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
export const getComments = async (postId) => {
  const response = await api.get(`/posts/${postId}/comments`);
  return response.data;
};

// ëŒ“ê¸€ ì‘ì„±
export const createComment = async (postId, content) => {
  const token = localStorage.getItem("token");
  const response = await api.post(
    `/posts/${postId}/comments`,
    { content },
    {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    }
  );
  return response.data;
};

// ëŒ“ê¸€ ì‚­ì œ
export const deleteComment = async (commentId) => {
  const token = localStorage.getItem("token");
  const response = await api.delete(`/comments/${commentId}`, {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });
  return response.data;
};
```

**ì„¤ëª…:**
- `getComments`: ê²Œì‹œë¬¼ IDë¡œ ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
- `createComment`: í† í°ê³¼ í•¨ê»˜ ëŒ“ê¸€ ì‘ì„±
- `deleteComment`: í† í°ìœ¼ë¡œ ê¶Œí•œ í™•ì¸ í›„ ì‚­ì œ

### 2.5 PostDetail ì»´í¬ë„ŒíŠ¸ - ëŒ“ê¸€ UI
**íŒŒì¼:** `frontend/src/components/PostDetail.jsx`
```javascript
// ëŒ“ê¸€ ê´€ë ¨ state
const [comments, setComments] = useState([]);
const [commentContent, setCommentContent] = useState("");
const [commentLoading, setCommentLoading] = useState(false);
const currentUser = JSON.parse(localStorage.getItem("user"));

useEffect(() => {
  // ëŒ“ê¸€ ì¡°íšŒ
  const fetchComments = async () => {
    try {
      const data = await getComments(id);
      if (data.success) {
        setComments(data.data.comments);
      }
    } catch (err) {
      console.error("ëŒ“ê¸€ ì¡°íšŒ ì‹¤íŒ¨:", err);
    }
  };

  fetchPost();
  fetchComments();
}, [id]);

// ëŒ“ê¸€ ì‘ì„±
const handleCommentSubmit = async (e) => {
  e.preventDefault();

  if (!currentUser) {
    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤");
    navigate("/login");
    return;
  }

  if (!commentContent.trim()) {
    alert("ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
    return;
  }

  try {
    setCommentLoading(true);
    const data = await createComment(id, commentContent);
    if (data.success) {
      setComments([data.data.comment, ...comments]); // ìƒˆ ëŒ“ê¸€ì„ ë§¨ ìœ„ì— ì¶”ê°€
      setCommentContent(""); // ì…ë ¥ì°½ ì´ˆê¸°í™”
    }
  } catch (err) {
    alert(err.response?.data?.message || "ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
  } finally {
    setCommentLoading(false);
  }
};

// ëŒ“ê¸€ ì‚­ì œ
const handleCommentDelete = async (commentId) => {
  if (!confirm("ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

  try {
    const data = await deleteComment(commentId);
    if (data.success) {
      setComments(comments.filter((c) => c._id !== commentId));
    }
  } catch (err) {
    alert(err.response?.data?.message || "ëŒ“ê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
  }
};
```

**ëŒ“ê¸€ ì„¹ì…˜ JSX:**
```jsx
{/* ëŒ“ê¸€ ì„¹ì…˜ */}
<div className="bg-white rounded-lg shadow-lg p-6 mt-6">
  <h2 className="text-2xl font-bold text-gray-800 mb-4">
    ğŸ’¬ ëŒ“ê¸€ ({comments.length})
  </h2>

  {/* ëŒ“ê¸€ ì‘ì„± í¼ */}
  {currentUser ? (
    <form onSubmit={handleCommentSubmit} className="mb-6">
      <textarea
        value={commentContent}
        onChange={(e) => setCommentContent(e.target.value)}
        placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."
        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
        rows={3}
        maxLength={500}
      />
      <div className="flex justify-between items-center mt-2">
        <span className="text-sm text-gray-500">
          {commentContent.length}/500
        </span>
        <button
          type="submit"
          disabled={commentLoading || !commentContent.trim()}
          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed"
        >
          {commentLoading ? "ì‘ì„±ì¤‘..." : "ëŒ“ê¸€ ì‘ì„±"}
        </button>
      </div>
    </form>
  ) : (
    <div className="mb-6 p-4 bg-gray-50 rounded-lg text-center">
      <p className="text-gray-600">
        ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´{" "}
        <button
          onClick={() => navigate("/login")}
          className="text-blue-600 hover:underline font-semibold"
        >
          ë¡œê·¸ì¸
        </button>
        ì´ í•„ìš”í•©ë‹ˆë‹¤.
      </p>
    </div>
  )}

  {/* ëŒ“ê¸€ ëª©ë¡ */}
  <div className="space-y-4">
    {comments.length === 0 ? (
      <p className="text-gray-500 text-center py-8">
        ì²« ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!
      </p>
    ) : (
      comments.map((comment) => (
        <div
          key={comment._id}
          className="border-b border-gray-200 pb-4 last:border-0"
        >
          <div className="flex justify-between items-start">
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-2">
                <span className="font-semibold text-gray-800">
                  {comment.author?.name || comment.author?.email}
                </span>
                <span className="text-sm text-gray-500">
                  {new Date(comment.createdAt).toLocaleString("ko-KR")}
                </span>
              </div>
              <p className="text-gray-700 whitespace-pre-wrap">
                {comment.content}
              </p>
            </div>
            {currentUser && currentUser.id === comment.author?._id && (
              <button
                onClick={() => handleCommentDelete(comment._id)}
                className="text-red-600 hover:text-red-800 text-sm ml-4"
              >
                ì‚­ì œ
              </button>
            )}
          </div>
        </div>
      ))
    )}
  </div>
</div>
```

**ì„¤ëª…:**
- ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ ëŒ“ê¸€ ì‘ì„± ê°€ëŠ¥
- 500ì ì œí•œ, ì‹¤ì‹œê°„ ê¸€ììˆ˜ í‘œì‹œ
- ë³¸ì¸ ëŒ“ê¸€ë§Œ ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
- ìµœì‹  ëŒ“ê¸€ì´ ìœ„ì— í‘œì‹œ
- ë¹„ë¡œê·¸ì¸ ì‹œ ë¡œê·¸ì¸ ìœ ë„ ë©”ì‹œì§€

---

## 3. ì¢‹ì•„ìš” ê¸°ëŠ¥ ì¶”ê°€

### 3.1 Post ëª¨ë¸ ìˆ˜ì •
**íŒŒì¼:** `backend/models/Post.js`
```javascript
const postSchema = new mongoose.Schema({
  title: {
    type: String,
    required: [true, "ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"],
    trim: true,
    maxlength: [100, "ì œëª©ì€ 100ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤"],
  },
  content: {
    type: String,
    required: [true, "ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"],
  },
  author: {
    type: mongoose.Schema.Types.ObjectId,
    ref: "User",
    required: [true, "ì‘ì„±ìê°€ í•„ìš”í•©ë‹ˆë‹¤"],
  },
  likes: [
    {
      type: mongoose.Schema.Types.ObjectId,
      ref: "User", // ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ìš©ìë“¤
    },
  ],
  createdAt: {
    type: Date,
    default: Date.now,
  },
  updatedAt: {
    type: Date,
    default: Date.now,
  },
});
```

**ì„¤ëª…:**
- `likes`: ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ìš©ì ID ë°°ì—´
- ë°°ì—´ ê¸¸ì´ê°€ ì¢‹ì•„ìš” ìˆ˜
- ì‚¬ìš©ì IDê°€ ë°°ì—´ì— ìˆìœ¼ë©´ ì¢‹ì•„ìš” ëˆ„ë¥¸ ìƒíƒœ

### 3.2 ì¢‹ì•„ìš” API ë¼ìš°íŠ¸
**íŒŒì¼:** `backend/routes/posts.js`
```javascript
// POST /api/posts/:id/like - ì¢‹ì•„ìš” í† ê¸€
router.post("/:id/like", async (req, res) => {
  // ì¸ì¦ ì²´í¬
  const authHeader = req.headers.authorization;

  if (!authHeader || !authHeader.startsWith("Bearer ")) {
    return res.status(401).json({
      success: false,
      message: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤",
    });
  }

  const token = authHeader.split(" ")[1];

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    const user = await User.findById(decoded.id);

    if (!user) {
      return res.status(401).json({
        success: false,
        message: "ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
      });
    }

    req.user = user;
  } catch (error) {
    console.error("ì¸ì¦ ì—ëŸ¬:", error);
    return res.status(401).json({
      success: false,
      message: "ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤",
    });
  }

  try {
    const post = await Post.findById(req.params.id);

    if (!post) {
      return res.status(404).json({
        success: false,
        message: "ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
      });
    }

    const userId = req.user._id;
    const likeIndex = post.likes.indexOf(userId);

    if (likeIndex > -1) {
      // ì´ë¯¸ ì¢‹ì•„ìš” ëˆ„ë¥¸ ê²½ìš° - ì œê±°
      post.likes.splice(likeIndex, 1);
    } else {
      // ì¢‹ì•„ìš” ì¶”ê°€
      post.likes.push(userId);
    }

    await post.save();

    res.json({
      success: true,
      message: likeIndex > -1 ? "ì¢‹ì•„ìš”ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤" : "ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤",
      data: {
        likesCount: post.likes.length,
        isLiked: likeIndex === -1,
      },
    });
  } catch (error) {
    console.error("ì¢‹ì•„ìš” ì—ëŸ¬:", error);
    res.status(500).json({
      success: false,
      message: "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
      error: error.message,
    });
  }
});
```

**ì„¤ëª…:**
- í† ê¸€ ë°©ì‹: ëˆ„ë¥´ë©´ ì¶”ê°€, ë‹¤ì‹œ ëˆ„ë¥´ë©´ ì œê±°
- `indexOf`: ë°°ì—´ì—ì„œ ì‚¬ìš©ì ID ì°¾ê¸°
- `splice`: ë°°ì—´ì—ì„œ ì œê±°
- `push`: ë°°ì—´ì— ì¶”ê°€
- ì¢‹ì•„ìš” ìˆ˜ì™€ ìƒíƒœ ë°˜í™˜

### 3.3 ê²Œì‹œë¬¼ ì¡°íšŒ ì‹œ ì¢‹ì•„ìš” ì •ë³´ í¬í•¨
**íŒŒì¼:** `backend/routes/posts.js`
```javascript
// GET /api/posts/:id - íŠ¹ì • ê²Œì‹œë¬¼ ì¡°íšŒ
router.get("/:id", async (req, res) => {
  try {
    const post = await Post.findById(req.params.id)
      .populate("author", "name email")
      .populate("likes", "name email"); // ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ìš©ì ì •ë³´ í¬í•¨

    if (!post) {
      return res.status(404).json({
        success: false,
        message: "ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
      });
    }

    res.json({
      success: true,
      data: {
        post,
      },
    });
  } catch (error) {
    console.error("ê²Œì‹œë¬¼ ì¡°íšŒ ì—ëŸ¬:", error);
    res.status(500).json({
      success: false,
      message: "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
      error: error.message,
    });
  }
});
```

**ì„¤ëª…:**
- `populate("likes")`: ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ìš©ì ì´ë¦„, ì´ë©”ì¼ ì¡°íšŒ
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ëˆ„ê°€ ì¢‹ì•„ìš” í–ˆëŠ”ì§€ í‘œì‹œ ê°€ëŠ¥

### 3.4 í”„ë¡ íŠ¸ì—”ë“œ API í•¨ìˆ˜
**íŒŒì¼:** `frontend/src/api.js`
```javascript
// ì¢‹ì•„ìš” í† ê¸€
export const likePost = async (postId) => {
  const token = localStorage.getItem("token");
  const response = await api.post(
    `/posts/${postId}/like`,
    {},
    {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    }
  );
  return response.data;
};
```

**ì„¤ëª…:**
- ë¹ˆ ê°ì²´ `{}`ë¥¼ bodyë¡œ ì „ì†¡ (POST ìš”ì²­ì´ì§€ë§Œ ë°ì´í„° ë¶ˆí•„ìš”)
- í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì¸ì¦

### 3.5 PostDetail ì»´í¬ë„ŒíŠ¸ - ì¢‹ì•„ìš” UI
**íŒŒì¼:** `frontend/src/components/PostDetail.jsx`
```javascript
// ì¢‹ì•„ìš” ê´€ë ¨ state
const [likesCount, setLikesCount] = useState(0);
const [isLiked, setIsLiked] = useState(false);
const [likeLoading, setLikeLoading] = useState(false);

useEffect(() => {
  const fetchPost = async () => {
    try {
      setLoading(true);
      const data = await getPost(id);
      if (data.success) {
        setPost(data.data.post);
        // ì¢‹ì•„ìš” ì •ë³´ ì´ˆê¸°í™”
        setLikesCount(data.data.post.likes?.length || 0);
        setIsLiked(
          currentUser && data.data.post.likes?.includes(currentUser.id)
        );
      }
    } catch (err) {
      setError(err.response?.data?.message || "Failed to fetch post");
    } finally {
      setLoading(false);
    }
  };

  fetchPost();
  fetchComments();
}, [id]);

// ì¢‹ì•„ìš” í† ê¸€
const handleLike = async () => {
  if (!currentUser) {
    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤");
    navigate("/login");
    return;
  }

  try {
    setLikeLoading(true);
    const data = await likePost(id);
    if (data.success) {
      setLikesCount(data.data.likesCount);
      setIsLiked(data.data.isLiked);
      
      // ê²Œì‹œë¬¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ì„œ ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ëŒ ëª©ë¡ ê°±ì‹ 
      const postData = await getPost(id);
      if (postData.success) {
        setPost(postData.data.post);
      }
    }
  } catch (err) {
    alert(err.response?.data?.message || "ì¢‹ì•„ìš” ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
  } finally {
    setLikeLoading(false);
  }
};
```

**ì¢‹ì•„ìš” UI JSX:**
```jsx
{/* ì¢‹ì•„ìš” ë²„íŠ¼ */}
<div className="mt-6">
  <div className="flex items-center gap-4">
    <button
      onClick={handleLike}
      disabled={likeLoading}
      className={`flex items-center gap-2 px-4 py-2 rounded-lg transition ${
        isLiked
          ? "bg-red-500 text-white hover:bg-red-600"
          : "bg-gray-100 text-gray-700 hover:bg-gray-200"
      } disabled:opacity-50 disabled:cursor-not-allowed`}
    >
      <span className="text-xl">{isLiked ? "â¤ï¸" : "ğŸ¤"}</span>
      <span className="font-semibold">{likesCount}</span>
    </button>
  </div>
  
  {/* ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ëŒë“¤ */}
  {post.likes && post.likes.length > 0 && (
    <p className="text-sm text-gray-500 mt-2">
      {post.likes.map((user, index) => (
        <span key={user._id || index}>
          {user.name || user.email}
          {index < post.likes.length - 1 ? ", " : ""}
        </span>
      ))}
      ë‹˜ì´ ì¢‹ì•„í•©ë‹ˆë‹¤
    </p>
  )}
</div>
```

**ì„¤ëª…:**
- `isLiked`: í˜„ì¬ ì‚¬ìš©ìê°€ ì¢‹ì•„ìš” ëˆŒë €ëŠ”ì§€ ì—¬ë¶€
- ë¹¨ê°„ í•˜íŠ¸(â¤ï¸): ì¢‹ì•„ìš” ìƒíƒœ
- í° í•˜íŠ¸(ğŸ¤): ë¯¸ì¢‹ì•„ìš” ìƒíƒœ
- ì¢‹ì•„ìš” ëˆ„ë¥¸ ì‚¬ëŒ ì´ë¦„ í‘œì‹œ (ì˜ˆ: "ê¹€ì§€ìš°, ì •ìœ¤ì„œë‹˜ì´ ì¢‹ì•„í•©ë‹ˆë‹¤")
- í´ë¦­ ì‹œ í† ê¸€ ë™ì‘

---

## ğŸ“Œ ì£¼ìš” ê°œë… ì •ë¦¬

### 1. MongoDB Populate
```javascript
.populate("author", "name email")
```
- ë‹¤ë¥¸ ì»¬ë ‰ì…˜ì˜ ë°ì´í„°ë¥¼ ì¡°ì¸í•´ì„œ ê°€ì ¸ì˜´
- ì²« ë²ˆì§¸ ì¸ì: ì°¸ì¡° í•„ë“œëª…
- ë‘ ë²ˆì§¸ ì¸ì: ê°€ì ¸ì˜¬ í•„ë“œ ëª©ë¡

### 2. JWT ì¸ì¦
```javascript
const token = localStorage.getItem("token");
headers: {
  Authorization: `Bearer ${token}`,
}
```
- Bearer í† í° ë°©ì‹ ì‚¬ìš©
- ì„œë²„ì—ì„œ JWT ê²€ì¦ í›„ ì‚¬ìš©ì í™•ì¸

### 3. ë°°ì—´ ì¡°ì‘
```javascript
// ì¶”ê°€
post.likes.push(userId);

// ì œê±°
const index = post.likes.indexOf(userId);
post.likes.splice(index, 1);

// ì¡´ì¬ í™•ì¸
const isLiked = post.likes.includes(userId);
```

### 4. React State ê´€ë¦¬
```javascript
// ë°°ì—´ì— ìƒˆ í•­ëª© ì¶”ê°€ (ë§¨ ì•)
setComments([newComment, ...comments]);

// ë°°ì—´ì—ì„œ í•­ëª© ì œê±°
setComments(comments.filter((c) => c._id !== id));
```

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### ê°œë°œ í™˜ê²½ ì‹¤í–‰
```bash
# ë°±ì—”ë“œ (í„°ë¯¸ë„ 1)
cd backend
npm run dev

# í”„ë¡ íŠ¸ì—”ë“œ (í„°ë¯¸ë„ 2)
cd frontend
npm run dev
```

### í™˜ê²½ë³€ìˆ˜ í™•ì¸ ì‚¬í•­
- âœ… `backend/.env` íŒŒì¼ ì¡´ì¬
- âœ… `MONGODB_URI` ê°’ ì„¤ì • (<db_password> êµì²´)
- âœ… `frontend/.env` íŒŒì¼ ì¡´ì¬
- âœ… `VITE_API_URL` ë°±ì—”ë“œ í¬íŠ¸ì™€ ì¼ì¹˜

---

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ERR_CONNECTION_REFUSED
**ì›ì¸:** ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
**í•´ê²°:** `cd backend && npm run dev` ì‹¤í–‰

### 2. MONGODB_URI ì—ëŸ¬
**ì›ì¸:** .env íŒŒì¼ì´ ì—†ê±°ë‚˜ ê°’ì´ ì˜ëª»ë¨
**í•´ê²°:** .env.example ë³µì‚¬ í›„ ì‹¤ì œ ê°’ ì…ë ¥

### 3. ì¢‹ì•„ìš”ê°€ ë°˜ì˜ ì•ˆë¨
**ì›ì¸:** ê²Œì‹œë¬¼ ì¡°íšŒ ì‹œ likes populate ëˆ„ë½
**í•´ê²°:** `.populate("likes", "name email")` ì¶”ê°€

### 4. ëŒ“ê¸€ ì‚­ì œ ê¶Œí•œ ì—ëŸ¬
**ì›ì¸:** ë³¸ì¸ ëŒ“ê¸€ì´ ì•„ë‹Œë° ì‚­ì œ ì‹œë„
**í•´ê²°:** í”„ë¡ íŠ¸ì—ì„œ ë³¸ì¸ ëŒ“ê¸€ë§Œ ì‚­ì œ ë²„íŠ¼ í‘œì‹œ

---

## ğŸ“ ë‹¤ìŒ ì‘ì—… ì˜ˆì •

- [ ] ëŒ“ê¸€ì— ëŒ€ëŒ“ê¸€ ê¸°ëŠ¥
- [ ] ê²Œì‹œë¬¼ ê²€ìƒ‰ ê¸°ëŠ¥
- [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ
- [ ] í˜ì´ì§€ë„¤ì´ì…˜
- [ ] ì•Œë¦¼ ê¸°ëŠ¥

---

**ì‘ì„±ì¼:** 2024ë…„ 12ì›” 25ì¼  
**ì‘ì—… ì‹œê°„:** ì•½ 4ì‹œê°„  
**ì£¼ìš” ì„±ê³¼:** ëŒ“ê¸€ ì‹œìŠ¤í…œ êµ¬ì¶•, ì¢‹ì•„ìš” ê¸°ëŠ¥ ì¶”ê°€, DB ì—°ê²° ì•ˆì •í™”
