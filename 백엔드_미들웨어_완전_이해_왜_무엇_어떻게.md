# ğŸ”§ ë°±ì—”ë“œ ë¯¸ë“¤ì›¨ì–´ ì™„ì „ ì´í•´ (ì™œ? ë¬´ì—‡? ì–´ë–»ê²Œ?)

> **ëª©í‘œ:** ë¯¸ë“¤ì›¨ì–´ê°€ ì™œ í•„ìš”í•œì§€, ì–´ë–¤ ë¡œì§ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€, ë°ì´í„°ê°€ ì–´ë–»ê²Œ ë³€í™˜ë˜ëŠ”ì§€, DB ì €ì¥ì€ ì–´ë””ì„œ í•˜ëŠ”ì§€ ì™„ë²½íˆ ì´í•´í•˜ê¸°

---

## ğŸ“ í”„ëŸ°íŠ¸ì—ì„œ FormDataë¥¼ ë³´ë‚¼ ë•Œ ë°±ì—”ë“œëŠ” ì–´ë–»ê²Œ ë°›ì„ê¹Œ?

### **ë¬¸ì œ ìƒí™©: í”„ëŸ°íŠ¸ì—ì„œ ë³´ë‚¸ FormDataë¥¼ ë°±ì—”ë“œëŠ” ê·¸ëƒ¥ ëª» ì”€**

```javascript
// í”„ëŸ°íŠ¸: api.js
const formData = new FormData();
formData.append("title", "ì œëª©");
formData.append("images", Fileê°ì²´);  // â† ë°”ì´ë„ˆë¦¬ ë°ì´í„°!

await api.post("/posts", formData);
// Content-Type: multipart/form-data; boundary=----...
// [multipart í˜•ì‹ì˜ ë°”ì´ë„ˆë¦¬ ë°ì´í„°]
```

**ë°±ì—”ë“œê°€ ë°›ìœ¼ë©´:**

```javascript
// ë°±: routes/posts.js (ë¯¸ë“¤ì›¨ì–´ ì—†ì´)

router.post("/", (req, res) => {
  console.log("req.body:", req.body);      // âŒ {}  (ë¹„ì–´ìˆìŒ!)
  console.log("req.files:", req.files);    // âŒ undefined
  
  const { title } = req.body;
  // âŒ titleì´ undefined! (ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ)
  
  // req.bodyê°€ ë¹„ì–´ìˆëŠ” ì´ìœ :
  // Expressì˜ ê¸°ë³¸ ë¯¸ë“¤ì›¨ì–´ (express.json())ëŠ” JSONë§Œ ì²˜ë¦¬
  // multipart/form-dataëŠ” ì²˜ë¦¬ ë°©ë²•ì„ ëª¨ë¦„!
});
```

**ì™œ ì´ëŸ° ì¼ì´ ë°œìƒí•˜ëŠ”ê°€?**

```
í”„ëŸ°íŠ¸ ì†¡ì‹                     ë°±ì—”ë“œ ìˆ˜ì‹ 

axios.post(..., formData)
         â†“                      
Content-Type: multipart        â†  ì´ í˜•ì‹ì„ ì¸ì‹í•  ë¯¸ë“¤ì›¨ì–´ê°€ ì—†ìœ¼ë©´
[multipart ë°”ì´ë„ˆë¦¬]            
         â†“                      req.bodyëŠ” ë¹„ì–´ìˆìŒ âŒ
         â†“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         â†“
express.json()ë§Œ ìˆìœ¼ë©´?      
app.use(express.json())        â† JSON í˜•ì‹ë§Œ ì²˜ë¦¬ ê°€ëŠ¥
         â†“
"multipartê°€ ë­ì§€?" ëª¨ë¦„
         â†“
req.body = {}  âŒ
req.files = undefined  âŒ
```

---

## ğŸ’¡ ë¯¸ë“¤ì›¨ì–´ê°€ í•„ìš”í•œ ì´ìœ 

### **ë¯¸ë“¤ì›¨ì–´ì˜ ì—­í• : "ìš”ì²­ ë°ì´í„° ë³€í™˜"**

```
ìš”ì²­ì´ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì— ë„ë‹¬í•˜ê¸° ì „ì—,
ìš”ì²­ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³  ë³€í™˜í•˜ëŠ” ì¤‘ê°„ ê³¼ì •

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­                          â”‚
â”‚    Content-Type: multipart/form-data        â”‚
â”‚    [ë°”ì´ë„ˆë¦¬ ë°ì´í„°...]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ ë¯¸ë“¤ì›¨ì–´ ì²´ì¸                           â”‚
â”‚    CORS â†’ JSON â†’ parseFormData â­          â”‚
â”‚    (ê° ë¯¸ë“¤ì›¨ì–´ê°€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ë‹¤ìŒìœ¼ë¡œ) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ (routes/posts.js)        â”‚
â”‚    req.bodyì™€ req.filesê°€ ì´ë¯¸ ì¤€ë¹„ë¨!     â”‚
â”‚    (ë¯¸ë“¤ì›¨ì–´ê°€ íŒŒì‹±í•´ì¤Œ)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¯¸ë“¤ì›¨ì–´ê°€ í•˜ëŠ” ì¼:
1. multipart/form-data ê°ì§€
2. ë°”ì´ë„ˆë¦¬ ë°ì´í„° íŒŒì‹± (Busboy)
3. req.bodyì™€ req.filesì— ì €ì¥
4. next() í˜¸ì¶œí•´ì„œ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ë¡œ ì´ë™
```

---

## ğŸ” ë°±ì—”ë“œ ì „ì²´ íë¦„ (ë¯¸ë“¤ì›¨ì–´ í¬í•¨)

```javascript
// backend/index.js

const express = require("express");
const app = express();

// ========================================
// 1ï¸âƒ£ ì´ˆê¸° ì„¤ì •
// ========================================
console.log("ğŸš€ Express ì•± ì‹œì‘");

// 2ï¸âƒ£ CORS ë¯¸ë“¤ì›¨ì–´
const cors = require("cors");
app.use(cors({
  origin: ["http://localhost:3000", "https://jiwooresume.vercel.app"],
  credentials: true
}));
console.log("âœ… CORS ë¯¸ë“¤ì›¨ì–´ ë“±ë¡");

// 3ï¸âƒ£ JSON ë¯¸ë“¤ì›¨ì–´ (JSON í˜•ì‹ì˜ ìš”ì²­ ì²˜ë¦¬)
app.use(express.json());
console.log("âœ… JSON ë¯¸ë“¤ì›¨ì–´ ë“±ë¡ (JSON í˜•ì‹ ìš”ì²­ ì²˜ë¦¬)");

// 4ï¸âƒ£ FormData ë¯¸ë“¤ì›¨ì–´ (multipart/form-data í˜•ì‹ì˜ ìš”ì²­ ì²˜ë¦¬) â­
const parseFormData = require("./middleware/parseFormData");
app.use(parseFormData);
console.log("âœ… parseFormData ë¯¸ë“¤ì›¨ì–´ ë“±ë¡ (FormData í˜•ì‹ ìš”ì²­ ì²˜ë¦¬)");

// 5ï¸âƒ£ ë¼ìš°íŠ¸ ë“±ë¡
const postsRouter = require("./routes/posts");
app.use("/api/posts", postsRouter);
console.log("âœ… POST /api/posts ë¼ìš°íŠ¸ ë“±ë¡");

// ========================================
// ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì´ë ‡ê²Œ ì²˜ë¦¬ë¨:
// ========================================

// ğŸ“¥ í”„ëŸ°íŠ¸ì—ì„œ POST /api/posts ìš”ì²­ (FormData)
//     â†“
//   ğŸ”µ CORS ë¯¸ë“¤ì›¨ì–´
//     (ìš”ì²­ ì¶œì²˜ í™•ì¸: http://localhost:3000? âœ…)
//     next() í˜¸ì¶œ
//     â†“
//   ğŸ”µ express.json() ë¯¸ë“¤ì›¨ì–´
//     (Content-Type: application/json? âŒ)
//     (FormDataë‹ˆê¹Œ ë¬´ì‹œ)
//     next() í˜¸ì¶œ
//     â†“
//   ğŸ”µ parseFormData ë¯¸ë“¤ì›¨ì–´ â­
//     (Content-Type: multipart/form-data? âœ…)
//     Busboyë¡œ íŒŒì‹±!
//     req.body = {title: "ì œëª©", content: "ë‚´ìš©"}
//     req.files = [{buffer: <Buffer...>}]
//     next() í˜¸ì¶œ
//     â†“
//   ğŸ”µ routes/posts.jsì˜ POST í•¸ë“¤ëŸ¬
//     (req.bodyì™€ req.filesê°€ ì´ë¯¸ ì¤€ë¹„ë¨!)
//     JWT ê²€ì¦
//     Cloudinary ì—…ë¡œë“œ
//     MongoDB ì €ì¥
//     ì‘ë‹µ ë°˜í™˜
```

---

## ğŸ› ï¸ ë¯¸ë“¤ì›¨ì–´ ìƒì„¸ ë™ì‘ (parseFormData.js)

### **ë¯¸ë“¤ì›¨ì–´ì˜ ì—­í• : FormData â†’ req.body, req.filesë¡œ ë³€í™˜**

```javascript
// backend/middleware/parseFormData.js

const busboy = require("busboy");

/**
 * ============================================
 * ë¯¸ë“¤ì›¨ì–´ì˜ ê¸°ë³¸ êµ¬ì¡°
 * ============================================
 * 
 * function middleware(req, res, next) {
 *   // req ê°ì²´ ì²˜ë¦¬/ìˆ˜ì •
 *   req.body = {...}
 *   req.files = [...]
 *   
 *   next();  // â† ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ë¡œ ì´ë™!
 * }
 */

function parseFormData(req, res, next) {
  // ========================================
  // 1ï¸âƒ£ ìš”ì²­ ë©”ì„œë“œ í™•ì¸
  // ========================================
  console.log(`\nğŸ“¥ [parseFormData] ìš”ì²­ ìˆ˜ì‹ `);
  console.log(`  - ë©”ì„œë“œ: ${req.method}`);
  
  // POST/PUTë§Œ ì²˜ë¦¬ (GET, DELETEëŠ” bodyê°€ ì—†ìœ¼ë¯€ë¡œ ë¶ˆí•„ìš”)
  if (req.method !== "POST" && req.method !== "PUT") {
    console.log(`  - â­ï¸  ${req.method} ìš”ì²­ì´ë¯€ë¡œ ë¯¸ë“¤ì›¨ì–´ ê±´ë„ˆëœ€`);
    return next();  // â† ì´ ë¯¸ë“¤ì›¨ì–´ ìŠ¤í‚µ, ë‹¤ìŒìœ¼ë¡œ ì´ë™
  }

  // ========================================
  // 2ï¸âƒ£ Content-Type í™•ì¸
  // ========================================
  const contentType = req.headers["content-type"];
  console.log(`  - Content-Type: ${contentType}`);

  // multipart/form-dataë§Œ ì²˜ë¦¬
  if (!contentType || !contentType.includes("multipart/form-data")) {
    console.log(`  - â­ï¸  multipartê°€ ì•„ë‹ˆë¯€ë¡œ ê±´ë„ˆëœ€`);
    console.log(`     (ë‹¤ë¥¸ ë¯¸ë“¤ì›¨ì–´ (express.json) ê°€ ì²˜ë¦¬í•¨)`);
    return next();  // â† ì´ ë¯¸ë“¤ì›¨ì–´ ìŠ¤í‚µ
  }

  // âœ… multipart/form-data ìš”ì²­ì´ ë§ìŒ!
  console.log(`  - âœ… FormData ìš”ì²­ ê°ì§€! íŒŒì‹± ì‹œì‘...`);

  // ========================================
  // 3ï¸âƒ£ req.bodyì™€ req.files ì´ˆê¸°í™”
  // ========================================
  req.body = {};       // í…ìŠ¤íŠ¸ í•„ë“œ ì €ì¥
  req.files = [];      // File ê°ì²´ë“¤ ì €ì¥

  console.log(`  - req.body ì´ˆê¸°í™”: {}`);
  console.log(`  - req.files ì´ˆê¸°í™”: []`);

  // ========================================
  // 4ï¸âƒ£ Busboy ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
  // ========================================
  // Busboy: multipart/form-dataë¥¼ íŒŒì‹±í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
  // íŒŒì¼ì„ ì²­í¬ ë‹¨ìœ„ë¡œ ë°›ìœ¼ë©´ì„œ ì²˜ë¦¬
  
  const bb = busboy({
    headers: req.headers,  // Content-Type, boundary ë“±
    limits: {
      fileSize: 8 * 1024 * 1024,  // ìµœëŒ€ 8MB
      files: 5,                    // ìµœëŒ€ 5ê°œ íŒŒì¼
    },
  });

  console.log(`  - Busboy ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (ìµœëŒ€ íŒŒì¼: 8MB, 5ê°œ)`);

  let fileCount = 0;
  let filesProcessed = 0;

  // ========================================
  // 5ï¸âƒ£ "file" ì´ë²¤íŠ¸: íŒŒì¼ í•„ë“œ ê°ì§€
  // ========================================
  // FormDataì—ì„œ íŒŒì¼ í•„ë“œë¥¼ ì°¾ìœ¼ë©´ ë°œìƒ
  
  bb.on("file", (fieldname, file, info) => {
    // fieldname: HTML formì˜ í•„ë“œëª… ("images")
    // file: ìŠ¤íŠ¸ë¦¼ ê°ì²´ (ë°ì´í„°ë¥¼ ì¡°ê¸ˆì”© ë°›ìŒ)
    // info: {filename: "photo1.jpg", mimeType: "image/jpeg"}

    fileCount++;
    
    console.log(`\n  ğŸ“ [íŒŒì¼ ì´ë²¤íŠ¸] íŒŒì¼ í•„ë“œ ê°ì§€: #${fileCount}`);
    console.log(`     - fieldname: "${fieldname}"`);
    console.log(`     - filename: "${info.filename}"`);
    console.log(`     - mimeType: "${info.mimeType}"`);

    // ================================
    // 5-1ï¸âƒ£ íŒŒì¼ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ëª¨ìœ¼ê¸°
    // ================================
    const chunks = [];  // íŒŒì¼ì˜ ê° ì²­í¬ë¥¼ ì €ì¥

    // íŒŒì¼ ë°ì´í„°ê°€ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ í˜¸ì¶œ
    file.on("data", (data) => {
      // data = Buffer ê°ì²´ (ë³´í†µ 64KB ë‹¨ìœ„)
      // í° íŒŒì¼ì´ë©´ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œë¨
      
      chunks.push(data);
      
      console.log(`     ğŸ“¥ ì²­í¬ ìˆ˜ì‹ : ${data.length} bytes`);
      // ì˜ˆ: ğŸ“¥ ì²­í¬ ìˆ˜ì‹ : 65536 bytes
      //    ğŸ“¥ ì²­í¬ ìˆ˜ì‹ : 65536 bytes
      //    ğŸ“¥ ì²­í¬ ìˆ˜ì‹ : 45824 bytes (ë§ˆì§€ë§‰)
    });

    // ================================
    // 5-2ï¸âƒ£ íŒŒì¼ ìˆ˜ì‹  ì™„ë£Œ
    // ================================
    file.on("end", () => {
      // ëª¨ë“  ì²­í¬ë¥¼ í•˜ë‚˜ì˜ Bufferë¡œ í•©ì¹˜ê¸°
      const buffer = Buffer.concat(chunks);

      console.log(`     âœ… íŒŒì¼ ì™„ì„±: ì´ ${buffer.length} bytes`);

      // req.files ë°°ì—´ì— ì €ì¥
      req.files.push({
        fieldname: fieldname,
        originalname: info.filename,
        mimetype: info.mimeType,
        size: buffer.length,
        buffer: buffer,  // â† ì´ê²ƒì´ í•µì‹¬!
        // buffer = <Buffer 89 50 4e 47 ff d8 ff e0 ...>
        // ì´ê²ƒì´ ë°”ë¡œ ì´ë¯¸ì§€ì˜ ë°”ì´ë„ˆë¦¬ ë°ì´í„°!
      });

      filesProcessed++;

      console.log(`     ğŸ’¾ req.files[${req.files.length - 1}]ì— ì €ì¥ë¨`);
    });

    file.on("error", (err) => {
      console.error(`     âŒ íŒŒì¼ ìŠ¤íŠ¸ë¦¼ ì—ëŸ¬:`, err);
    });
  });

  // ========================================
  // 6ï¸âƒ£ "field" ì´ë²¤íŠ¸: í…ìŠ¤íŠ¸ í•„ë“œ ê°ì§€
  // ========================================
  // FormDataì—ì„œ í…ìŠ¤íŠ¸ í•„ë“œë¥¼ ì°¾ìœ¼ë©´ ë°œìƒ
  
  bb.on("field", (fieldname, val) => {
    // fieldname: "title" ë˜ëŠ” "content"
    // val: "ì œëª©" ë˜ëŠ” "ë‚´ìš©"

    req.body[fieldname] = val;
    
    console.log(`  ğŸ“ [í•„ë“œ ì´ë²¤íŠ¸] í…ìŠ¤íŠ¸ í•„ë“œ`);
    console.log(`     - fieldname: "${fieldname}"`);
    console.log(`     - value: "${val}"`);
  });

  // ========================================
  // 7ï¸âƒ£ "close" ì´ë²¤íŠ¸: íŒŒì‹± ì™„ë£Œ
  // ========================================
  bb.on("close", () => {
    console.log(`\n  âœ… [íŒŒì‹± ì™„ë£Œ ì´ë²¤íŠ¸]`);
    console.log(`  - filesProcessed: ${filesProcessed}/${fileCount}`);
    console.log(`  - req.body:`, req.body);
    console.log(`  - req.files.length: ${req.files.length}`);

    // ëª¨ë“  íŒŒì¼ì´ ì²˜ë¦¬ë  ë•Œê¹Œì§€ ëŒ€ê¸°
    if (filesProcessed < fileCount) {
      console.log(`  â³ ì•„ì§ ì²˜ë¦¬ ì¤‘ì¸ íŒŒì¼ ìˆìŒ, ëŒ€ê¸°...`);
      
      const waitInterval = setInterval(() => {
        if (filesProcessed >= fileCount) {
          clearInterval(waitInterval);
          console.log(`  âœ… ëª¨ë“  íŒŒì¼ ì²˜ë¦¬ë¨!`);
          console.log(`  ğŸ“¤ next() í˜¸ì¶œ â†’ routes/posts.jsë¡œ ì´ë™`);
          next();  // â† ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ (ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬)ë¡œ ì´ë™!
        }
      }, 10);

      // ì•ˆì „ì¥ì¹˜: 5ì´ˆ í›„ ë¬´ì¡°ê±´ ì§„í–‰
      setTimeout(() => {
        clearInterval(waitInterval);
        console.log(`  âš ï¸  íƒ€ì„ì•„ì›ƒ (5ì´ˆ), ê°•ì œë¡œ next() í˜¸ì¶œ`);
        next();
      }, 5000);
    } else {
      console.log(`  âœ… íŒŒì¼ ì²˜ë¦¬ ì™„ë£Œ!`);
      console.log(`  ğŸ“¤ next() í˜¸ì¶œ â†’ routes/posts.jsë¡œ ì´ë™`);
      next();
    }
  });

  bb.on("error", (err) => {
    console.error(`  âŒ Busboy ì—ëŸ¬:`, err);
    res.status(400).json({
      success: false,
      message: "FormData íŒŒì‹± ì‹¤íŒ¨",
      error: err.message,
    });
  });

  // ========================================
  // 8ï¸âƒ£ HTTP ìš”ì²­ ìŠ¤íŠ¸ë¦¼ì„ Busboyì— ì—°ê²°
  // ========================================
  // req (ì…ë ¥) â†’ Busboy (íŒŒì„œ) â†’ íŒŒì‹±ë¨
  console.log(`  ğŸ”— HTTP ìŠ¤íŠ¸ë¦¼ì„ Busboyì— ì—°ê²°`);
  
  req.pipe(bb);
}

module.exports = parseFormData;

// ========================================
// ë¯¸ë“¤ì›¨ì–´ ì‹¤í–‰ í›„ ìƒíƒœ:
// ========================================
// 
// req.body = {
//   title: "ì œëª©",
//   content: "ë‚´ìš©"
// }
//
// req.files = [
//   {
//     fieldname: "images",
//     originalname: "photo1.jpg",
//     mimetype: "image/jpeg",
//     size: 558624,
//     buffer: <Buffer 89 50 4e 47 ff d8 ff e0 ... (558624 bytes)>
//   },
//   {
//     fieldname: "images",
//     originalname: "photo2.png",
//     mimetype: "image/png",
//     size: 1024768,
//     buffer: <Buffer 89 50 4e 47 ... (1024768 bytes)>
//   }
// ]
//
// âœ… ì´ì œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ!
```

---

## ğŸ“Š ë¯¸ë“¤ì›¨ì–´ ì „/í›„ ë°ì´í„° ë¹„êµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë¯¸ë“¤ì›¨ì–´ BEFORE                                          â”‚
â”‚ (í”„ëŸ°íŠ¸ì—ì„œ ë³´ë‚¸ ìƒíƒœ)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HTTP ìš”ì²­:                                              â”‚
â”‚  POST /api/posts HTTP/1.1                               â”‚
â”‚  Content-Type: multipart/form-data; boundary=...        â”‚
â”‚  Authorization: Bearer [token]                          â”‚
â”‚                                                         â”‚
â”‚  ------WebKitFormBoundary7MA4YWxkTrZu0gW               â”‚
â”‚  Content-Disposition: form-data; name="title"          â”‚
â”‚                                                         â”‚
â”‚  ì œëª©                                                   â”‚
â”‚  ------WebKitFormBoundary7MA4YWxkTrZu0gW               â”‚
â”‚  Content-Disposition: form-data; name="content"        â”‚
â”‚                                                         â”‚
â”‚  ë‚´ìš©                                                   â”‚
â”‚  ------WebKitFormBoundary7MA4YWxkTrZu0gW               â”‚
â”‚  Content-Disposition: form-data; name="images";        â”‚
â”‚  filename="photo1.jpg"                                  â”‚
â”‚  Content-Type: image/jpeg                              â”‚
â”‚                                                         â”‚
â”‚  [ë°”ì´ë„ˆë¦¬ ë°ì´í„° 558624 bytes]                        â”‚
â”‚  ------WebKitFormBoundary7MA4YWxkTrZu0gW--             â”‚
â”‚                                                         â”‚
â”‚ req ê°ì²´:                                               â”‚
â”‚  - req.body = undefined âŒ                              â”‚
â”‚  - req.files = undefined âŒ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              â†“ parseFormData ë¯¸ë“¤ì›¨ì–´ ì²˜ë¦¬ â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë¯¸ë“¤ì›¨ì–´ AFTER                                           â”‚
â”‚ (ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ìƒíƒœ)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ req ê°ì²´:                                               â”‚
â”‚                                                         â”‚
â”‚  req.body = {                                           â”‚
â”‚    title: "ì œëª©",                                       â”‚
â”‚    content: "ë‚´ìš©"                                      â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  req.files = [                                          â”‚
â”‚    {                                                    â”‚
â”‚      fieldname: "images",                               â”‚
â”‚      originalname: "photo1.jpg",                        â”‚
â”‚      mimetype: "image/jpeg",                            â”‚
â”‚      size: 558624,                                      â”‚
â”‚      buffer: <Buffer 89 50 4e 47 ff d8 ff e0 ...>     â”‚
â”‚    }                                                    â”‚
â”‚  ]                                                      â”‚
â”‚                                                         â”‚
â”‚  req.headers = {                                        â”‚
â”‚    authorization: "Bearer [í† í°]",                      â”‚
â”‚    ...                                                  â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚ âœ… ì´ì œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì‚¬ìš© ê°€ëŠ¥!                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬: DB ì €ì¥ ìœ„ì¹˜

### **ë¯¸ë“¤ì›¨ì–´ í›„ì— ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë¨**

```javascript
// backend/routes/posts.js

const express = require("express");
const router = express.Router();
const jwt = require("jsonwebtoken");
const Post = require("../models/Post");
const User = require("../models/User");
const { uploadImageBuffer } = require("../lib/cloudinary");

// @route   POST /api/posts
// @desc    ê²Œì‹œë¬¼ ì‘ì„±
// @access  Private

// â­ ë¯¸ë“¤ì›¨ì–´ê°€ ë‹¤ìŒì„ í•˜ê³  next()ë¥¼ í˜¸ì¶œí•˜ë©´ ì´ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë¨

router.post("/", async (req, res) => {
  try {
    console.log("\nğŸš€ [POST /api/posts í•¸ë“¤ëŸ¬ ì‹œì‘]");

    // ========================================
    // Step 1: ë¯¸ë“¤ì›¨ì–´ì—ì„œ ì¤€ë¹„í•œ ë°ì´í„° í™•ì¸
    // ========================================
    console.log("ğŸ“¦ ë¯¸ë“¤ì›¨ì–´ì—ì„œ ì¤€ë¹„ëœ ë°ì´í„°:");
    console.log("  - req.body:", req.body);
    console.log("  - req.files.length:", req.files?.length);
    console.log("  - req.headers.authorization:", 
      req.headers.authorization?.substring(0, 20) + "...");

    // ========================================
    // Step 2: JWT ê²€ì¦ (í† í°ì—ì„œ userId ì¶”ì¶œ)
    // ========================================
    const authHeader = req.headers.authorization;
    if (!authHeader || !authHeader.startsWith("Bearer ")) {
      return res.status(401).json({
        success: false,
        message: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤",
      });
    }

    const token = authHeader.split(" ")[1];
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    const userId = decoded.id;

    console.log("âœ… JWT ê²€ì¦ ì„±ê³µ:");
    console.log("  - userId:", userId);

    // ========================================
    // Step 3: req.bodyì—ì„œ ë°ì´í„° ì¶”ì¶œ
    // ========================================
    const { title, content } = req.body;
    // req.body = {title: "ì œëª©", content: "ë‚´ìš©"}
    // â†‘ ë¯¸ë“¤ì›¨ì–´ê°€ íŒŒì‹±í•´ì¤€ ë°ì´í„°!

    console.log("ğŸ“ ìš”ì²­ ë°ì´í„°:");
    console.log("  - title:", title);
    console.log("  - content:", content);

    if (!title || !content) {
      return res.status(400).json({
        success: false,
        message: "ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”",
      });
    }

    // ========================================
    // Step 4: req.filesì—ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ
    // ========================================
    let images = [];

    if (req.files?.length) {
      // req.files = [
      //   {
      //     fieldname: "images",
      //     originalname: "photo1.jpg",
      //     mimetype: "image/jpeg",
      //     size: 558624,
      //     buffer: <Buffer ...> â† ë°”ì´ë„ˆë¦¬!
      //   }
      // ]
      // â†‘ ë¯¸ë“¤ì›¨ì–´ê°€ íŒŒì‹±í•´ì¤€ ë°ì´í„°!

      console.log(`ğŸ“¤ ${req.files.length}ê°œ íŒŒì¼ Cloudinary ì—…ë¡œë“œ ì‹œì‘`);

      // Promise.all()ë¡œ ëª¨ë“  íŒŒì¼ ë³‘ë ¬ ì—…ë¡œë“œ
      images = await Promise.all(
        req.files.map(async (file, index) => {
          console.log(`  ğŸ–¼ï¸ íŒŒì¼ ${index + 1}: ${file.originalname}`);

          // lib/cloudinary.jsì˜ uploadImageBuffer() í˜¸ì¶œ
          const result = await uploadImageBuffer(file.buffer, {
            folder: "blog-posts",
          });

          console.log(`  âœ… ì—…ë¡œë“œ ì™„ë£Œ: ${result.secure_url}`);

          return result.secure_url;
        })
      );

      // images = [
      //   "https://res.cloudinary.com/daijhkfrg/image/upload/v1735507825/blog-posts/abc123.jpg",
      //   "https://res.cloudinary.com/daijhkfrg/image/upload/v1735507826/blog-posts/def456.jpg"
      // ]

      console.log("âœ… ëª¨ë“  ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ");
    }

    // ========================================
    // Step 5: MongoDBì— Post ì €ì¥ â­ DB SAVE
    // ========================================
    console.log("ğŸ’¾ MongoDB Post ì €ì¥ ì‹œì‘");

    const post = await Post.create({
      title: title,              // "ì œëª©"
      content: content,          // "ë‚´ìš©"
      images: images,            // ["https://...", "https://..."]
      author: userId,            // ObjectId
    });

    console.log("âœ… MongoDB ì €ì¥ ì™„ë£Œ:");
    console.log("  - _id:", post._id);
    console.log("  - title:", post.title);
    console.log("  - images:", post.images);

    // post ê°ì²´:
    // {
    //   _id: ObjectId("695352479a374cba4d8d4826"),
    //   title: "ì œëª©",
    //   content: "ë‚´ìš©",
    //   images: [
    //     "https://res.cloudinary.com/daijhkfrg/image/upload/v1735507825/blog-posts/abc123.jpg"
    //   ],
    //   author: ObjectId("507f1f77bcf86cd799439011"),
    //   likes: [],
    //   comments: [],
    //   createdAt: 2025-12-30T10:30:25.000Z,
    //   updatedAt: 2025-12-30T10:30:25.000Z,
    //   __v: 0
    // }

    // ========================================
    // Step 6: í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µ ë°˜í™˜
    // ========================================
    console.log("ğŸ“¤ í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µ ë°˜í™˜");

    res.status(201).json({
      success: true,
      message: "ê²Œì‹œë¬¼ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤",
      data: { post },  // â† ì €ì¥ëœ post ê°ì²´ ë°˜í™˜
    });

    // ì´ JSONì´ HTTP ì‘ë‹µìœ¼ë¡œ í”„ëŸ°íŠ¸ë¡œ ì „ì†¡ë¨:
    // HTTP/1.1 201 Created
    // Content-Type: application/json
    // {
    //   "success": true,
    //   "message": "ê²Œì‹œë¬¼ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤",
    //   "data": {
    //     "post": {
    //       "_id": "...",
    //       "title": "ì œëª©",
    //       "images": ["https://..."],
    //       ...
    //     }
    //   }
    // }

  } catch (error) {
    console.error("âŒ ì—ëŸ¬ ë°œìƒ:", error);

    res.status(500).json({
      success: false,
      message: "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
      error: error.message,
    });
  }
});

module.exports = router;
```

---

## ğŸ“Š ì „ì²´ ìš”ì²­ â†’ ì‘ë‹µ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ í”„ëŸ°íŠ¸: FormData ì†¡ì‹                                â”‚
â”‚   axios.post("/api/posts", formData)                   â”‚
â”‚   Content-Type: multipart/form-data                    â”‚
â”‚   [íŒŒì¼ ë°”ì´ë„ˆë¦¬ ë°ì´í„°...]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ (HTTPS POST)
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ ë°±: index.js - ë¯¸ë“¤ì›¨ì–´ ì²´ì¸                       â”‚
â”‚                                                         â”‚
â”‚   ğŸ”µ CORS ë¯¸ë“¤ì›¨ì–´                                      â”‚
â”‚      (ì¶œì²˜ í™•ì¸: âœ…)                                     â”‚
â”‚      next() í˜¸ì¶œ                                       â”‚
â”‚      â†“                                                 â”‚
â”‚   ğŸ”µ express.json() ë¯¸ë“¤ì›¨ì–´                           â”‚
â”‚      (JSON? âŒ FormDataë‹ˆê¹Œ ìŠ¤í‚µ)                      â”‚
â”‚      next() í˜¸ì¶œ                                       â”‚
â”‚      â†“                                                 â”‚
â”‚   ğŸ”µ parseFormData ë¯¸ë“¤ì›¨ì–´ â­ (ì—¬ê¸°ì„œ í•µì‹¬!)          â”‚
â”‚      (multipart? âœ…)                                    â”‚
â”‚      Busboyë¡œ íŒŒì‹±                                     â”‚
â”‚      req.body = {title: "ì œëª©", content: "ë‚´ìš©"}      â”‚
â”‚      req.files = [{buffer: <Buffer...>}]              â”‚
â”‚      next() í˜¸ì¶œ                                       â”‚
â”‚      â†“                                                 â”‚
â”‚   ğŸ”µ routes/posts.jsì˜ POST í•¸ë“¤ëŸ¬                    â”‚
â”‚      (req.bodyì™€ req.files ì¤€ë¹„ë¨!)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬: ë¡œì§ ì²˜ë¦¬                            â”‚
â”‚                                                         â”‚
â”‚   1. JWT ê²€ì¦ (userId ì¶”ì¶œ)                           â”‚
â”‚   2. req.bodyì—ì„œ title, content ì¶”ì¶œ                 â”‚
â”‚   3. req.files[0].bufferë¥¼ Cloudinaryë¡œ ì—…ë¡œë“œ        â”‚
â”‚      â†’ secure_url ë°˜í™˜                                 â”‚
â”‚   4. MongoDBì— Post.create({                          â”‚
â”‚        title, content,                                â”‚
â”‚        images: ["https://..."],                       â”‚
â”‚        author: userId                                 â”‚
â”‚      })                                               â”‚
â”‚   5. ì‘ë‹µ ìƒì„±                                        â”‚
â”‚      res.status(201).json({                           â”‚
â”‚        success: true,                                 â”‚
â”‚        data: { post }                                 â”‚
â”‚      })                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ (HTTPS JSON ì‘ë‹µ)
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£ í”„ëŸ°íŠ¸: api.js - ì‘ë‹µ ì¸í„°ì…‰í„°                     â”‚
â”‚   response.data ì¶”ì¶œ ë° ë°˜í™˜                           â”‚
â”‚   â†’ {success: true, data: {post}}                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5ï¸âƒ£ í”„ëŸ°íŠ¸: PostCreate.jsx                             â”‚
â”‚   const response = await createPost()                  â”‚
â”‚   // response ìˆ˜ì‹ !                                    â”‚
â”‚   alert("ê²Œì‹œë¬¼ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!")                    â”‚
â”‚   window.location.reload()                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ í•µì‹¬ ì´í•´

### **ë¯¸ë“¤ì›¨ì–´ê°€ ì™œ í•„ìš”í•œê°€?**

```javascript
// âŒ ë¯¸ë“¤ì›¨ì–´ ì—†ì´
router.post("/", (req, res) => {
  const { title } = req.body;  // âŒ undefined!
  const file = req.files[0];   // âŒ undefined!
  // FormDataë¥¼ ì²˜ë¦¬í•  ë°©ë²•ì´ ì—†ìŒ
});

// âœ… ë¯¸ë“¤ì›¨ì–´ ìˆì´
app.use(parseFormData);  // â† FormDataë¥¼ ì²˜ë¦¬

router.post("/", (req, res) => {
  const { title } = req.body;  // âœ… "ì œëª©"
  const file = req.files[0];   // âœ… {buffer: <Buffer...>}
  // ë¯¸ë“¤ì›¨ì–´ê°€ ì´ë¯¸ ì²˜ë¦¬í•´ì¤Œ!
});
```

### **ë¯¸ë“¤ì›¨ì–´ê°€ í•˜ëŠ” ë¡œì§**

```javascript
// 1. multipart/form-data ê°ì§€
if (!contentType.includes("multipart/form-data")) return next();

// 2. Busboyë¡œ íŒŒì‹±
const bb = busboy({headers: req.headers});

// 3. íŒŒì¼ í•„ë“œ ì²˜ë¦¬
bb.on("file", (fieldname, file, info) => {
  const chunks = [];
  file.on("data", (data) => chunks.push(data));
  file.on("end", () => {
    req.files.push({
      buffer: Buffer.concat(chunks)  // â† ë°”ì´ë„ˆë¦¬ ë°ì´í„°
    });
  });
});

// 4. í…ìŠ¤íŠ¸ í•„ë“œ ì²˜ë¦¬
bb.on("field", (fieldname, val) => {
  req.body[fieldname] = val;
});

// 5. íŒŒì‹± ì™„ë£Œ
bb.on("close", () => next());

// 6. ìŠ¤íŠ¸ë¦¼ ì—°ê²°
req.pipe(bb);
```

### **ë¯¸ë“¤ì›¨ì–´ í›„ ë°ì´í„°ëŠ”?**

```javascript
// req.body = {title: "ì œëª©", content: "ë‚´ìš©"}
// req.files = [
//   {
//     fieldname: "images",
//     buffer: <Buffer 89 50 4e 47 ff d8 ff e0 ...>  // â† ì´ê²Œ ì´ë¯¸ì§€!
//   }
// ]
```

### **DB ì €ì¥ì€ ì–´ë””?**

```javascript
// routes/posts.jsì˜ POST í•¸ë“¤ëŸ¬ ì•ˆì—ì„œ:

// 1. req.bodyì—ì„œ ë°ì´í„° ì¶”ì¶œ
const { title, content } = req.body;

// 2. req.files[0].bufferë¥¼ Cloudinaryë¡œ ì—…ë¡œë“œ
const result = await uploadImageBuffer(req.files[0].buffer);

// 3. MongoDBì— ì €ì¥ â­
const post = await Post.create({
  title,
  content,
  images: [result.secure_url],  // â† Cloudinary URL
  author: userId
});

// 4. ì‘ë‹µ ë°˜í™˜
res.status(201).json({success: true, data: {post}});
```

---

## ğŸ¯ ì •ë¦¬: ë¯¸ë“¤ì›¨ì–´ì™€ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ì˜ ê´€ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë¯¸ë“¤ì›¨ì–´ (parseFormData)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì—­í• : ë°ì´í„° ì „í™˜ (ë³€í™˜)                     â”‚
â”‚                                             â”‚
â”‚ ì…ë ¥:                                       â”‚
â”‚   - Content-Type: multipart/form-data       â”‚
â”‚   - [ë°”ì´ë„ˆë¦¬ ìŠ¤íŠ¸ë¦¼]                       â”‚
â”‚                                             â”‚
â”‚ ì¶œë ¥:                                       â”‚
â”‚   - req.body = {title, content}             â”‚
â”‚   - req.files = [{buffer}]                  â”‚
â”‚                                             â”‚
â”‚ next() í˜¸ì¶œ â†’ ë‹¤ìŒìœ¼ë¡œ ì´ë™                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ (routes/posts.js)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì—­í• : ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰                     â”‚
â”‚                                             â”‚
â”‚ ì…ë ¥:                                       â”‚
â”‚   - req.body (ë¯¸ë“¤ì›¨ì–´ê°€ ì¤€ë¹„)               â”‚
â”‚   - req.files (ë¯¸ë“¤ì›¨ì–´ê°€ ì¤€ë¹„)              â”‚
â”‚                                             â”‚
â”‚ ì²˜ë¦¬:                                       â”‚
â”‚   - JWT ê²€ì¦                                â”‚
â”‚   - Cloudinary ì—…ë¡œë“œ                       â”‚
â”‚   - MongoDB ì €ì¥                            â”‚
â”‚                                             â”‚
â”‚ ì¶œë ¥:                                       â”‚
â”‚   - res.json({success, data: {post}})       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¯¸ë“¤ì›¨ì–´: "ë°ì´í„°ë¥¼ ì¤€ë¹„í•´ì£¼ëŠ” ì¡°ìˆ˜"
ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬: "ì‹¤ì œ ì‘ì—…ì„ í•˜ëŠ” ë‹´ë‹¹ì"
```

